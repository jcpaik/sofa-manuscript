Let $\Theta$ be a finite set of angles such that $\{0, \pi/2\} \subseteq \Theta \subseteq [0, \pi/2]$. That is, $\Theta$ is a partition
$$0 = \theta_0 < \theta_1 < \theta_2 < \cdots < \theta_n = \pi/2$$
of the interval $[0, \pi/2]$. The task of `SofaDesigner` is to compute the set of all _monotone hallway intersections_ $S$ with area at least $2.2195\dots$. We first recall the precise definition and shape of $S$. Essentially, $S$ is the intersection of horizontal strip $H = \mathbb{R} \times [0, 1]$ and the hallways rotated by each angle of $\Theta$.

$H = \mathbb{R} \times [0, 1]$ is the horizontal strip of height 1. $L$ is the right-angled hallway of width 1, with inner corner at $(0, 0)$ and outer corner at $(1, 1)$. Mathematically, $L = (-\infty, 1] \times [0, 1] \cup [0, 1] \times (-\infty, 1]$. The lines $a$, $b$, $c$, $d$ defined by equations $x=1$, $x=0$, $y=1$, $y=0$ respectively are the walls of the hallway $L$. For any $0 \leq i \leq n$, let $L_i$ be a copy of the hallway $L$ rotated counterclockwise by an angle of $\theta_i$ with an arbitrary inner corner $\mathbf{x}_i$. Let $a_i$, $b_i$, $c_i$ and $d_i$ be the sides of the hallway $L_i$ corresponding to the sides $a, b, c,$ and $d$ of $L$. 

The monotone hallway intersection $S$ is the intersection of the horizontal strip $H$ and the hallways $L_i$. Moreover, the sides $y=0$ and $y=1$ of $H$ and the outer walls $a_i$ and $c_i$ of $L_i$ for any $0 \leq i \leq n$ should determine all the sides of a convex polygon $K$. The sides $a_n = c_0$ are equal to the line $y=1$ and determines the upper horizontal edge of $K$. The sides $a_0, a_1, \dots, a_{n-1}$ forms the sides of $K$ on right, and each side $a_i$ connects the vertices $A_{i}$ and $A_{i+1}$. The side $a_i$ 

Although we allow some sides of $K$ to degenerate and have zero length, the lines should touch $K$.
consists of a cap $K \in \mathcal{K}_\Theta$ subtracted by the niche $\mathcal{N}(K)$ bounded by a polyline.

Take an arbitrary monotone intersection $S$ with angle set $\Theta$ and cap $K \in \mathcal{K}_\Theta$. Essentially, $S$ is the intersection of the horizontal strip $H$ and hallways $L_i$ each rotated by angle $\theta_i \in \Theta$, such that the outer walls $a_i$ and $c_i$ of $K$ form the upper edges of $K$. Monotone intersection $S = K \setminus \mathcal{N}(K)$ consists of the convex polygon $K$ subtracted by the 

Given a linear functional $f$ on $\mathcal{K}_\Theta$, `SofaDesigner` will be able to calculate an upper/lower bound of $f$ on $\mathcal{S}$. It will be used extensively to prove theorems like injectivity theorem.

The state of monotone hallway intersection $S$ can be described equivalently 

- The corners $\mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_n$ of the hallways.
- The support function values $p_1, p_2, \dots, p_n$ and $q_1, q_2, \dots, q_n$ of the right and left part of the cap.

Now the cap $K$ can be parametrized by a finite number of variables. 

The space $\mathcal{K}_\Theta$ is finite-dimensional. An $K \in \mathcal{K}_\Theta$ can be expressed in terms of any of the following coordinate systems.
- The support function values $p_i = p(\theta_i)$ on $\Theta$.
- The edge lengths $b_i = \beta_K(\left\{ \theta_i \right\}) \geq 0$ of the upper boundary of $\delta K$.
- The coordinates of the inner corners $\mathbf{x}_i = \mathbf{x}_K(\theta_i)$.
Now each coordinate system constrainted by the following linear equalities and inequalities correspond one-to-one to the space $\mathcal{K}_\Theta$.
- 
$\mathcal{K}_\Theta^0$ is the normalized space.

Any $K \in \mathcal{K}_\Theta$ is free to translate horizontally. With this, we assume $p_0 = 0$.



- IDEA: provide a format for theorems proved by `SofaDesigner`: 
	- `Verify(theta, ineq)` is true by computation X.
- How does SofaDesigner do this?
	- The formula of a sofa is determined by its polyline.
		- Omit the formal proof.
	- Once a polyline is determined, the problem is a quadratic programming problem.
	- SofaDesigner branches the space of polygon intersections 
		- Either A <= B or A >= B, so it is guaranteed that no space is being wasted
	- As the nodes are branched, the polyline becomes more apparent
		- ANY polyline starting with left ray, some edges in middle, followed by the right ray provides a subset of the niche.
		- ...given that they SHOULD appear in that order.
	- If the upper bound < sofa area, then we cut the node because it has no possibility.
	- 
- Verifying SofaDesigner
	- Nodes: each split does not omit any nodes
	- Ensure that the vertices do appear in that order
	- Every node gives rise to a concave area formula

TODO: change the coordinates to support value $p$ instead of $b$?
- May help boost speedup
- Needs programming time
- 

- Nondegeneracy: We don't want any perturbation of sofas to break into two chunks. That way, we can guarantee that our intersection is _balanced_.
	- This needs verification via software.
- 
- It can be said that `SofaDesinger` captures the global information of how a maximum sofa should behave.
	- Remark: Romik-Kallus essentially show that if we increase the number of angles, it will provide finer upper bound approaching the actual value.


In short, the previous chapters have shown that a sofa is essentially the intersection of rotated hallways. Instead of fixing the hallway $L$ and moving the sofa $S$ inside $L$, we can fix the sofa $S$ and see the movement in the point of view of $S$ so that $L$ is rotating while containing the sofa $S$. Note also that $S$ has to be contained in the horizontal strip $H = \mathbb{R} \times [0, 1]$ so that it can be moved freely around a straight hallway as well. So the problem of maximizing the area of a sofa is to maximize the area of the intersection of all rotating hallways and the horizontal strip $H$.

The aim of the software `SofaDesigner` is to maximize the hallway intersection of the strip $H$ and a finite number of hallways $L_1, L_2, \dots, L_n$ rotated counterclockwise by a predetermined, finite set of angles $\theta_1, \theta_2, \dots, \theta_n$.

We describe what exactly is a hallway intersection and specify what `SofaDesigner` does. 

# Parameters and Variables

The list of angles $\theta_i$ is fixed as a given constant. But the positions $\mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_{n-1}$ of the hallways are _variables_. Our polygonal sofa $S$ solely depends on the variables $\mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_{n-1}$. Moreover, we introduce the following notations as well. All such notions, except for $u_i$ and $v_i$, also depend on $\mathbf{x}_i$'s as well.

- For every $0 \leq i \leq n$, define two orthogonal unit vectors $u_i = \left( \cos (\theta_i), \sin(\theta_i) \right)$ and $v_i = \left( - \sin(\theta_i), \cos(\theta_i) \right)$. Also, define $\mathbf{y}_i = \mathbf{x}_i + u_i + v_i$. Check that $\mathbf{y}_i$ is the outer corner of the hallway $L_i$.
- For every $1 \leq i < n$, let $p_i$ and $q_i$ be the real values that satisfy $\mathbf{y}_i = p_i u_i + q_i v_i$. Note that the position of $\mathbf{x}_i$ can be effectively represented as a linear formula of $p_i$ and $q_i$ (and vice versa). 

Moreover, we have shown in previous sections that we can impose the following extra condition as follows.

- The following list of lines form the edges of a convex polygon $K$ called the _cap_ of the sofa $S$.
	- $a_1, a_2, \dots, a_{n-1}$, the line $y=1$, $c_1, c_2, \dots, c_{n-1}$, the line $y=0$.
- This condition can be 

The set of all hallway intersections is given by the state $(\mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_n)$, and the set of all states that gives a valid hallway intersection forms a _convex polytope_ inside . That is, a region described by a finite number of inequalities.
- Describe the exact inequalities required for a finite version 

# Goals of `SofaDesigner`

We would like to analyze the region where $S$ is at least the area of Gerver's sofa. 

# Combinatorial Arrangement of Hallways

Any intersection or union of polygons are polygons. Moreover, the order of which edges appears in the edges hold importance as well. We denote this as the _combinatorial type_ of ...



%%
Questions:
- How to make them verify a QP?

There are multiple ways to verify a QP:
- Supply certificate for a predetermined value / polynomials
	- Fastest. But would love to have other ways to formulate the problem and verify as well!

Program:
- uses _edge lengths_ as the primitive variables, and represent all the other variables as a formula for it.
	- Advantage: them >= 0 is a valid condition for already.
	- 
- Also, no condition of x(i) being inside the cap has been imposed, which is fortunate.
%%