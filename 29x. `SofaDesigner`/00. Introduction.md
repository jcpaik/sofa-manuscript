Let $\Theta$ be a finite set of angles such that $\{0, \pi/2\} \subseteq \Theta \subseteq [0, \pi/2]$. That is, $\Theta$ is a partition
$$0 = \theta_0 < \theta_1 < \theta_2 < \cdots < \theta_n = \pi/2$$
of the interval $[0, \pi/2]$. The task of `SofaDesigner` is to compute the set of all _monotone hallway intersections_ $S$ with the set of angles $\Theta$ and an area at least $2.2195\dots$. Essentially, $S$ is a polygonal intersection of the hallways of width 1 rotated by each angle of $\Theta$.

# Definition of Monotone Hallway Intersection $S$

We first provide the precise definition and shape of a monotone hallway intersection $S$ with angle set $\Theta$. All the details in this section is important.

$H = \mathbb{R} \times [0, 1]$ is the horizontal strip of height 1. $L$ is the right-angled hallway of width 1, with inner corner at $\mathbf{x} = (0, 0)$ and outer corner at $\mathbf{y} = (1, 1)$. Mathematically, $L = (-\infty, 1] \times [0, 1] \cup [0, 1] \times (-\infty, 1]$. Let $a$ and $b$ be the lines $x=1$ and $y=1$ passing through the outer corner $\mathbf{y}$ representing the outer walls of $L$. Let $c$ and $d$ be the half-lines $(-\infty, 0] \times \left\{ 0 \right\}$ and $\left\{ 0 \right\} \times (-\infty, 0]$ emanating from the inner corner $\mathbf{x}$ representing the inner walls of $L$. 

For all $0 \leq i \leq n$, let $u_i = (\cos \theta_i, \sin \theta_i)$ and $v_i = (-\sin \theta_i, \cos \theta_i)$ so that the vectors $u_i$ and $v_i$ form a orthogonal basis. Also, let $v_{i + n} = - u_i$ for all $0 \leq i \leq n$ so that $v_i$ is defined for all indices $i$ from $0$ to $2n$. For any $0 \leq i \leq n$, let $L_i$ be a copy of the hallway $L$ rotated counterclockwise by an angle of $\theta_i$ and translated so that the inner corner is positioned at $\mathbf{x}_i$. Here, the set $S$ is the intersection of the horizontal strip $H$ and the rotated hallways $L_i$. Let $a_i$, $b_i$, $c_i$ and $d_i$ be the sides of the hallway $L_i$ corresponding to the sides $a, b, c,$ and $d$ of $L$.

For the intersection $S$ to be a monotone hallway intersection, we require the following conditions. 

- (WLOG) Without loss of generality, we assume that $L_0 = L$ so that $\mathbf{x}_0 = (0, 0)$. Also, we assume that $\mathbf{x}_n$ has the $y$-coordinate equal to zero. Consequently, the sides $a_n$ and $c_0$ are equal to the line $y=1$.
- (Monotonicity) The sides $y=0$ and $y=1$ of $H$ and the outer walls $a_i$ and $c_i$ of $L_i$ for any $0 \leq i \leq n$ should determine all the sides of a convex polygon $K$ called the _cap_ of $S$.

Consequently, the sides $a_n$ and $c_0$ are equal to the line $y=1$ and determines the upper horizontal edge of $K$. The sides $a_0, a_1, \dots, a_{n-1}$ forms the different edge of $K$ on the right side in counterclockwise order, and the sides $c_1, c_2, \dots, c_n$ forms the different edges of $K$ on the right side in counterclockwise order. All the lines $a_0, a_1, \dots, a_{n-1}, a_n = c_0, c_1, \dots, c_n$, and $y = 0$ should form the edges of $K$ in counterclockwise order, although we allow some edges of $K$ to degenerate and have zero length.

For any $0 < i \leq n$, let $A_i$ be the intersection of $a_{i-1}$ and $a_i$. Also let $A_0$ be the intersection of $a_0$ and the line $y=0$. Likewise, for any $0 \leq i < n$, let $C_i$ be the intersection of $c_i$ and $c_{i+1}$. Also let $C_n$ be the intersection of $a_0$ and the line $y=0$. Then the points $A_0, A_1, \dots, A_n$ forms the vertices of $K$ on the right side, and the points $C_0, C_1, \dots, C_n$ forms the vertices of $K$ on the left side. For any $0 \leq i \leq n$, define $A_{n + 1 + i} = A_i$ so that the list $A_0, A_1, \dots, A_{2n + 1}$ forms all the vertices of $K$ in the counterclockwise order.

With this, the monotonicity condition of hallway intersection $S$ can be expressed as the following inequalities: for all $0 \leq i \leq 2 n$, define $E_i$ as the inequality $(A_{i+1} - A_i) \cdot v_i \geq 0$.

# Coordinate Systems of $S$

A monotone hallway intersection $S$ is completely determined by its cap $K$. Also, the state of $S$ can be described in any of the following three equivalent coordinates.

- The inner corners $\mathbf{x}_0, \mathbf{x}_1, \dots, \mathbf{x}_n \in \mathbb{R}^2$ of the hallways with following constraints.
	- (WLOG) $\mathbf{x}_0 = (0, 0)$ and $\mathbf{x}_n$ has $y$-coordinate equal to zero.
	- (Monotone) The inequality $E_i$ expressed in terms of coordinates of $x_j$'s. Note that the lines $a_i$ and $b_i$ are $\left\{ p \in \mathbb{R}^2 :  \right\}$
- The support function values $p_0, p_1, \dots, p_n$ and $q_0, q_1, \dots, q_n$ of the right and left part of the cap.
	- (WLOG) $p_0 = p_n = q_n = 1$
	- (Monotone) The inequality $E_i$ expressed in terms of coordinates of $x_j$'s.
- The edge lengths $s_i$ of cap $K$.
	- (WLOG)
	- (Monotone)

All three coordinate systems are convertible to each other. So any of the coordinate systems determine the space $\mathcal{K}_\Theta$ of all caps. 

# Niche of $S$

We define the _niche_ $\mathcal{N}(K)$ of the monotone hallway intersection $S$ as the region bounded from below by the line $y=0$, and bounded from above by the upper envelope of the line $y=0$ and the half-lines $c_i$ and $d_i$ for all $0 \leq i \leq n$. Then the area of $S$ is equal to the area of $K$ subtracted by the area of $\mathcal{N}(K)$. 



Given a linear functional $f$ on $\mathcal{K}_\Theta$, `SofaDesigner` will be able to calculate an upper/lower bound of $f$ on $\mathcal{S}$. It will be used extensively to prove theorems like injectivity theorem.




- IDEA: provide a format for theorems proved by `SofaDesigner`: 
	- `Verify(theta, ineq)` is true by computation X.
- How does SofaDesigner do this?
	- The formula of a sofa is determined by its polyline.
		- Omit the formal proof.
	- Once a polyline is determined, the problem is a quadratic programming problem.
	- SofaDesigner branches the space of polygon intersections 
		- Either A <= B or A >= B, so it is guaranteed that no space is being wasted
	- As the nodes are branched, the polyline becomes more apparent
		- ANY polyline starting with left ray, some edges in middle, followed by the right ray provides a subset of the niche.
		- ...given that they SHOULD appear in that order.
	- If the upper bound < sofa area, then we cut the node because it has no possibility.
	- 
- Verifying SofaDesigner
	- Nodes: each split does not omit any nodes
	- Ensure that the vertices do appear in that order
	- Every node gives rise to a concave area formula

TODO: change the coordinates to support value $p$ instead of $b$?
- May help boost speedup
- Needs programming time
- 

- Nondegeneracy: We don't want any perturbation of sofas to break into two chunks. That way, we can guarantee that our intersection is _balanced_.
	- This needs verification via software.
- 
- It can be said that `SofaDesinger` captures the global information of how a maximum sofa should behave.
	- Remark: Romik-Kallus essentially show that if we increase the number of angles, it will provide finer upper bound approaching the actual value.


In short, the previous chapters have shown that a sofa is essentially the intersection of rotated hallways. Instead of fixing the hallway $L$ and moving the sofa $S$ inside $L$, we can fix the sofa $S$ and see the movement in the point of view of $S$ so that $L$ is rotating while containing the sofa $S$. Note also that $S$ has to be contained in the horizontal strip $H = \mathbb{R} \times [0, 1]$ so that it can be moved freely around a straight hallway as well. So the problem of maximizing the area of a sofa is to maximize the area of the intersection of all rotating hallways and the horizontal strip $H$.

The aim of the software `SofaDesigner` is to maximize the hallway intersection of the strip $H$ and a finite number of hallways $L_1, L_2, \dots, L_n$ rotated counterclockwise by a predetermined, finite set of angles $\theta_1, \theta_2, \dots, \theta_n$.

We describe what exactly is a hallway intersection and specify what `SofaDesigner` does. 

The set of all hallway intersections is given by the state $(\mathbf{x}_1, \mathbf{x}_2, \dots, \mathbf{x}_n)$, and the set of all states that gives a valid hallway intersection forms a _convex polytope_ inside . That is, a region described by a finite number of inequalities.
- Describe the exact inequalities required for a finite version 

# Goals of `SofaDesigner`

We would like to analyze the region where $S$ is at least the area of Gerver's sofa. 



%%
Questions:
- How to make them verify a QP?

There are multiple ways to verify a QP:
- Supply certificate for a predetermined value / polynomials
	- Fastest. But would love to have other ways to formulate the problem and verify as well!

Program:
- uses _edge lengths_ as the primitive variables, and represent all the other variables as a formula for it.
	- Advantage: them >= 0 is a valid condition for already.
	- 
- Also, no condition of x(i) being inside the cap has been imposed, which is fortunate.
%%