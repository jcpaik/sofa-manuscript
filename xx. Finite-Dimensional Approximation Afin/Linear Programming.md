안녕하세요. 소파 프로그램 검증에 관심 가져주셔서 감사합니다. 

앞으로 종종 이렇게 가볍게 소프트웨어 검증에 필요한 내용들을 적어보려고 하는데요, 저도 처음 해 보는 일이라 설명이 좀 중구난방이고 시간이 지나면서 내용이 엎치락 뒤치락 할 수 있습니다. 이 부분 양해 부탁드려요.

오늘은 가볍게 선형계획법 (Linear Programming)에 대해 얘기해보려고 합니다. 이름에 programming이 있지만 사실 최적화 문제인데요, 예시론 다음과 같은 문제가 있습니다.

- $x, y$ 가 다음 조건을 만족하는 변수일때
	- $x + 2y \leq 14$
	- $3x - y \geq 0$
	- $x - y \leq 2$
- $3x + 4y$ 의 최대값을 찾아라.

어떤 식이 선형이라 함은 상수 곱하기 변수 꼴의 텀들이 합해진 꼴이라는 뜻입니다. 문제 꼴을 보시면 유한한 개수의 변수들이 있고, 유한 개의 선형부등식이 조건으로 주어져 있습니다. 그리고 문제의 목표는 어떤 선형식의 최대값/최소값을 찾는 문제입니다. 

위 문제의 답은 $x = 6$, $y=4$ 일때 $3x+4y=34$ 입니다. 그림으로 그리면 아래와 같습니다. 
![[images/linear-programming.png]]

그림에서 보이는 것처럼, 부등식들 조건에서 나오는 공간은 변수가 두개일 때 볼록다각형입니다. 변수가 3개면 볼록다면체 (이를테면 깍두기나 축구공같은) 가 되구요, $n$개 변수일 땐 $n$차원의 볼록 공간이 됩니다.

이런 선형계획법 문제를 푸는 솔버가 다양하게 알려져 있습니다. 나중에 설명드리겠지만, 소파 프로그램을 검증할 때는 이 솔버를 열심히 돌려야 합니다. 그런데 여기선 소파 프로그램이 수학적 증명이 되어야 하기 때문에 **모든 계수가 float이 아닌 자릿수 제한이 없는 유리수입니다**. 제가 알기론 이런 유리계수 정확한 선형계획법 문제를 풀어주는 솔버가 두가지 있습니다.
- [CGAL QP Solver](https://doc.cgal.org/latest/QP_solver/index.html) : 제 `SofaDesigner`에서 쓰는 라이브러리입니다. 
- [SoPlex](https://soplex.zib.de/doc/html/EXACT.php) : 저도 솔직히 어떻게 쓰는지 모릅니다. 근데 욕심같아선 검증 프로그램은 다른 솔버를 쓰는게 교차검증에 좋긴 합니다.
검증기를 짜려면 아마 제일 처음 해야 할 부분 중 하나가 이런 라이브러리랑 연결하는 것일 겁니다.

그런데, 이런 솔버에도 문제가 있습니다. 과연 솔버가 주는 답이 정말 맞는 답일까요? 위 예제의 경우에는 그림을 그리면 알 수 있지만, 그리기 전까지는 답이 $x = 6$, $y=4$ 라고 해도 진짜 그런지 알 방법이 없습니다. $x = 6$, $y=4$일때 $3x+4y=34$니까 최대값이 적어도 34인거는 알 수 있는데, 혹시라도 34보다 더 큰 값이 나올수도 있지 않을까요? 신기하게도 최대값이 최대 34라는 간단한 증명이 있습니다.

- 조건 $x + 2y \leq 14$에 7/3을 곱하고
- 조건 $y - 3x \leq 0$에 (부호 방향을 $\leq$로 바꿨습니다) 0을 곱하고
- 조건 $x - y \leq 2$에 2/3을 곱해서
전부 더하면 $3x+4y \leq 34$가 나옵니다. 

부등식에 0 이상의 수를 곱해도 그 부등식이 성립하고, 부등식끼리는 더해도 성립합니다. 그래서 최종 결과인 부등식도 맞는 부등식이지요. 모든 선형계획법의 답은 이렇게 각 조건에 특정 0 이상 계수를 곱한뒤 전부 더하는 방식으로 검증이 가능합니다. 이렇게 증명을 이루는 계수를 일반적으로는 _certificate_, 선형계획법에서는 _dual maximizer_ 등 다양한 이름으로 부르는 것 같습니다. 웬만한 솔버는 이런 certificate도 같이 계산해줍니다. 

그러므로 선형계획법 문제 하나를 검증하려면 다음 과정을 거쳐야 합니다.
- Solver를 불러서 최적값 후보를 얻는다. ($x = 6$, $y=4$)
- 이 최적값 후보가 실제 최적값임을 certificate를 이용해 검증한다.
답을 어떻게 찾았는지는 솔버의 영역이고, 검증할때 굳이 솔버의 모든 과정을 확인 안 해도 됩니다. 어차피 답을 확인하고 certificate으로 검증하면 되거든요.

`SofaDesigner`의 최종 결과물은 선형부등식 집합으로 된 트리입니다. Root에는 모든 소파들의 집합이 선형부등식 형태로 주어져 있습니다. 하나의 노드는 어떤 부등식 또는 그 반대가 성립하는 경우로 나뉘구요. 그래서 전체 소파의 집합을 여러 작은 조각들로 쪼개서 처리하는 형태입니다. 이 트리의 검증은 기본적으로 각 leaf node 대해 선형계획법을 부르는 방식으로 진행됩니다. 하나의 노드가 두개로 쪼개질 때 놓쳐지는 영역이 없기 때문에, 이 트리의 최종 leaf들에서만 검증해도 충분합니다.
![[lp-tree.png]]

그런데 이게 끝이 아닙니다. 소파의 넓이는 일차식 (선형식) 이 아니라 이차식이라서 Quadratic Programming (번역하면 대충 이차식계획법일까요) 또한 불러야 합니다. Quadratic Programming의 검증에 대해서는 저도 공부를 해야 해서, 다 하게 되면 더 쓰겠습니다. 그럼 오늘은 이만...