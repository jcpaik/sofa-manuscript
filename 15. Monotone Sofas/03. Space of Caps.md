We have just seen that any maximum sofa $S$ rotating by an angle of $\omega \in [0, \pi/2]$ can be assumed to be a monotone sofa with cap $K$ and angle set $[0, \omega]$. That is, the maximum sofa $S$ is the cap $K$ subtracted by the niche $\mathcal{N}(K)$. Thus, the study of maximum sofas can be reduced to the study on caps $K$ and its monotonization. We will now think in terms of the space of caps.

> __Definition [cap-space].__ For any angle set $\Theta$, let $\mathcal{K}_\Theta$ be the set of caps $K$ with angle set $\Theta$. For any $\omega \in [0, \pi/2]$, let $\mathcal{K}_\omega = \mathcal{K}_{[0, \omega]}$. ^def-cap-space

Note that 

In this subsection, $K$ is an arbitrary cap with rotation angle $\omega \in [0, \pi/2]$ and a closed angle set $\left\{ 0, \omega \right\} \subseteq \Theta \subseteq \left[ 0, \omega \right]$. 

We define geometric information of $K$ and

> __Theorem [cap-mixin].__ For any caps $K_1$ and $K_2$ with same rotation angle $\omega$ and angle set $\Theta$, the set $K = (1-\lambda)K_1 + \lambda K_2$ is also a cap. ^thm-cap-mixin

> __Theorem [cap-contains-vertex].__ If $\omega < \pi/2$, then $K$ contains the vertex $p_{\omega}$ of $P_{\omega}$. ^thm-cap-contains-vertex

> __Theorem [boundary-measure-cap].__ The boundary measure $\beta_K$ of $K$ on $S^1$  has support in $\Theta \cup (\Theta + \pi/2) \cup \{\pi + \omega, 3\pi/2\}$ and satisfies the followings. ^thm-boundary-measure-cap
$$
\int_{t \in \Theta} \cos(t) \, \beta_K(dt) = 1 \qquad \int_{t \in \Theta + \pi/2} \cos\left( \omega + \pi/2 - t \right)  \, \beta_K(dt) = 1
$$

> __Theorem [cap-from-boundary-measure].__ Conversely to [[#^thm-boundary-measure-cap]], let $\beta$ be a measure on $\Theta \cup (\Theta + \pi/2)$ that satisfies the following equation.  ^thm-cap-from-boundary-measure
$$
\int_{t \in \Theta} \cos(t) \, \beta_K(dt) = 1 \qquad \int_{t \in \Theta + \pi/2} \cos\left( \omega + \pi/2 - t \right)  \, \beta_K(dt) = 1
$$
> Then the followings hold.
> 
> - If $\omega = \pi/2$, then there is a cap $K$ with rotation angle $\omega$ and angle set $\Theta$ such that $\beta_K|_{\Theta \cup (\Theta + \pi/2)} = \beta$. This is unique up to horizontal translation: all the other caps $K'$ satisfying the same condition is a horizontal translation of $K$.
> - If $\omega < \pi/2$, then there is a unique cap $K$ with rotation angle $\omega$ and angle set $\Theta$ such that $\beta_K|_{\Theta \cup (\Theta + \pi/2)} = \beta$.

> __Theorem [cap-special-vertex].__ If $\omega < \pi/2$, then $A^+_K(\omega) = p_\omega = C^-_K(\omega)$. ^thm-cap-special-vertex

> __Theorem [upper-boundary-is-jordan-arc].__ If $K$ has a nonzero area, then the upper boundary $\delta K$ is a Jordan arc. ^thm-upper-boundary-is-jordan-arc

> __Theorem [cap-from-upper-boundary].__ We have $p_{\delta K}$ and $p_K$ matching on the domain $\Theta \cup \Theta + \pi/2$. Consequently, $\mathcal{C} (\delta K) = \mathcal{C}(K)$. ^thm-cap-from-upper-boundary

> __Theorem [cap-tangent-arm-length].__ For any $t \in [0, \omega]$, let $g_K^+(t)$ be the value such that $\mathbf{y}(t) = A^+_K(t) + g_K^+(t) v_t$. Let $g_K^-(t)$ be the value such that $\mathbf{y}(t) = A^-_K(t) + g_K^-(t) v_t$. Let $h_K^+(t)$ be the value such that $\mathbf{y}(t) = C^+_K(t) + h_K^+(t) u_t$. Let $h_K^-(t)$ be the value such that $\mathbf{y}(t) = C^-_K(t) + h_K^-(t) u_t$. ^thm-cap-tangent-arm-length

# Differential Geometry of Caps

> __Definition [inner-corner-deriv].__ For any cap $K$, $\mathbf{v}_K^+ (t)$ is the right derivative of $\mathbf{x}$ at $t$ and $\mathbf{v}_K^- (t)$ is the left derivative of $\mathbf{x}$ at $t$. ^def-inner-corner-deriv
$$
\mathbf{v}_K^{-} (t_0) = \lim_{t \rightarrow t_0^-} \frac{\mathbf{x}(t) - \mathbf{x}(t_0)}{t - t_0} \qquad
\mathbf{v}_K^{+} (t_0) = \lim_{t \rightarrow t_0^+} \frac{\mathbf{x}(t) - \mathbf{x}(t_0)}{t - t_0}.
$$

TODO: polish the theorem below.

> __Theorem [inner-corner-deriv].__ For any cap $K$, $\mathbf{v}_K^+ (t)$ exists for any $0 \leq t < \pi / 2$ and is equal to the following. ^thm-inner-corner-deriv
$$
\begin{align*}
	\mathbf{v}_K^+(t) = -(g_K^+(t) - 1) \cdot u_t + (h_K^+(t) - 1) \cdot v_t
\end{align*}
$$
> Likewise, $\mathbf{v}_K^- (t)$ exists for all $0 < t \leq \pi / 2$ and is equal to the following.
$$
\begin{equation*}
	\mathbf{v}_K^-(t) = -(g_K^-(t) - 1) \cdot u_t + (h_K^-(t) - 1) \cdot v_t
\end{equation*}
$$

_Proof._ (sketch) Take any $0 \leq t < \pi / 2$ and set $s = t + \delta$ for sufficiently small and arbitrary $\delta > 0$. We simplify $\mathbf{v}^+(t) = \lim_{\delta \rightarrow 0^+}(\mathbf{x}(s) - \mathbf{x}(t)) / \delta$.
	
Since $A_{t, s}$ is on lines $a(t)$ and $a(s)$, it satisfies both $$A_{t, s} \cdot u_t = \mathbf{x}(t) \cdot u_t + 1$$ and  $$A_{t, s} \cdot u_s = \mathbf{x}(s) \cdot u_s + 1.$$
Rewrite $u_s = \cos \delta \cdot u_t + \sin \delta \cdot v_t$ on the second equation and we have
$$
\begin{align*}
	A_{t, s} \cos \delta \cdot u_t + A_{t, s} \sin \delta \cdot v_t =  	\cos \delta (\mathbf{x}(s) \cdot u_t) + \sin \delta (\mathbf{x}(s) \cdot v_t) + 1.
\end{align*}
$$
Group by $\cos \delta$ and $\sin \delta$ and substitute $A_{t, s} \cdot u_t$ with first equation then
$$ \cos \delta (\mathbf{x}(s) \cdot u_t - \mathbf{x}(t) \cdot u_t) + (1 - \cos \delta)
	= \sin \delta (A_{t, s}  (s) \cdot v_t - \mathbf{x}(s) \cdot v_t) .
	$$
Divide by $\delta$ and send $\delta$ to zero. We get
$$ \mathbf{v}_K^+(t) \cdot u_t  = (A^+(t) - \mathbf{x}(t)) \cdot v_t$$
Note that $g_t^+ = (\mathbf{y}(t) - A^+(t)) \cdot v_t = (\mathbf{x}(t) - A^+(t))\cdot v_t + 1$ so we have 
$$ \mathbf{v}_K^+(t) \cdot u_t = 1 - g_t ^+.$$
A similar argument can be applied to show $\mathbf{v}^+(t) \cdot v_t = h_t^+ - 1$ and thus the first equation of the theorem.  A symmetric argument shows the second equation of the theorem.  â–¡

> __Theorem [inner-corner-deriv-exists-almost-everywhere].__ For any cap $K$, $\mathbf{v}_K^+ (t) = \mathbf{v}_K^-(t)$ for all $0 < t < \pi / 2$ except some countable values. ^thm-inner-corner-deriv-exists-almost-everywhere