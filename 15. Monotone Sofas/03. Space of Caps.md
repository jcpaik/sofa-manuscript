We have just seen that any maximum sofa $S$ rotating by an angle of $\omega \in [0, \pi/2]$ can be assumed to be a monotone sofa with cap $K$ and angle set $[0, \omega]$. That is, the maximum sofa $S$ is the cap $K$ subtracted by the niche $\mathcal{N}(K)$. Thus, the study of maximum sofas can be reduced to the study on caps $K$ and its monotonization. We will now think in terms of the space of caps.

> __Definition [cap-space].__ For any angle set $\Theta$, let $\mathcal{K}_\Theta$ be the set of caps $K$ with angle set $\Theta$. For any $\omega \in [0, \pi/2]$, let $\mathcal{K}_\omega = \mathcal{K}_{[0, \omega]}$. ^def-cap-space

Note that the space $\mathcal{K}_\Theta$ is a convex space.

> __Theorem [cap-mixin].__ For any caps $K_1$ and $K_2$ with same angle set $\Theta$, the convex combination $K = (1-\lambda)K_1 + \lambda K_2$ is also a cap with angle set $\Theta$. That is, the space $\mathcal{K}_\Theta$ is a convex space. ^thm-cap-mixin

Not all caps $K$ in $\mathcal{K}_\omega$ gives rise to a monotone sofa $\mathcal{M}_{[0, \omega]}(K)$. Indeed, [[#^thm-monotonization-connected-iff]] specifies exactly when does $K$ gives rise to a sofa. So the space of monotone sofas can be understood as a subset of the space $\mathcal{K}_\omega$ of caps.

From now on, we will define and prove the geometric properties of caps in $K_\Theta$. Note that we have defined [[02. Monotone Sofas#^def-cap-vertices|vertices]] and [[02. Monotone Sofas#^def-cap-lines|walls of the rotating hallway]] for any cap $K$ previously. We can also define the inner and outer corner of the rotating hallway $L_K(t)$. 

> __Definition [cap-corners].__ Let $K$ be a cap with angle set $\Theta$ and rotation angle $\omega$. For any $t \in \Theta$, define the inner corner $\mathbf{x}_K(t)$ and outer corner $\mathbf{y}_K(t)$ as the following. ^def-cap-corners
$$
\mathbf{x}_K(t) = \left( p_K(t) - 1 \right) u_t + \left( p_K(t+\pi/2)-1 \right) v_t = b_K(t) \cap d_K(t)
$$
$$
\mathbf{y}_K(t) = p_K(t) u_t + p_K(t+\pi/2) v_t = a_K(t) \cap c_K(t)
$$

Next, we observe that the space $K_\omega$ behaves a bit differently when $\omega=\pi/2$ or $\omega < \pi/2$. Basically, the space $K_{ \pi/2 }$ has an extra degree of freedom by horizontal translation.

> __Theorem [cap-contains-vertex].__ If $\omega < \pi/2$, then any $K \in \mathcal{K}_\omega$ contains the vertex $p_{\omega}$ of $P_{\omega}$, and we have $A^+_K(\omega) = p_\omega = C^-_K(0)$. If $\omega = \pi/2$, then any $K \in \mathcal{K}_\omega$ translated horizontally is also contained in $\mathcal{K}_\omega$. That is, $K_{\pi/2}$ is closed under horizontal translation. Also the upper edge $e_{K}(\pi/2)$ is the horizontal line segment connecting $A^+_K(\pi/2) = C^+_K(0)$ to $A^-_K(\pi/2) = C^-_K(0)$ from left to right. ^thm-cap-contains-vertex

Next, we relate any cap in $K_\Theta$ to its boundary measure. This correspondence is bijective.

> __Theorem [boundary-measure-cap].__ The boundary measure $\beta_K$ of $K$ on $S^1$  has support in $\Theta \cup (\Theta + \pi/2) \cup \{\pi + \omega, 3\pi/2\}$ and satisfies the followings. ^thm-boundary-measure-cap
$$
\int_{t \in \Theta} \cos(t) \, \beta_K(dt) = 1 \qquad \int_{t \in \Theta + \pi/2} \cos\left( \omega + \pi/2 - t \right)  \, \beta_K(dt) = 1
$$

_Proof._ We have $\left( A^+_K(\omega) - A^-_K(0) \right) \cdot v_0 = 1$ for any cap $K$. Applying  □

> __Theorem [cap-from-boundary-measure].__ Conversely to [[#^thm-boundary-measure-cap]], let $\beta$ be a measure on $\Theta \cup (\Theta + \pi/2)$ that satisfies the following equation.  ^thm-cap-from-boundary-measure
$$
\int_{t \in \Theta} \cos(t) \, \beta_K(dt) = 1 \qquad \int_{t \in \Theta + \pi/2} \cos\left( \omega + \pi/2 - t \right)  \, \beta_K(dt) = 1
$$
> Then the followings hold.
> 
> - If $\omega = \pi/2$, then there is a cap $K$ with rotation angle $\omega$ and angle set $\Theta$ such that $\beta_K|_{\Theta \cup (\Theta + \pi/2)} = \beta$. This is unique up to horizontal translation: all the other caps $K'$ satisfying the same condition is a horizontal translation of $K$.
> - If $\omega < \pi/2$, then there is a unique cap $K$ with rotation angle $\omega$ and angle set $\Theta$ such that $\beta_K|_{\Theta \cup (\Theta + \pi/2)} = \beta$.

%%
__Theorem [upper-boundary-is-jordan-arc].__ If $K$ has a nonzero area, then the upper boundary $\delta K$ is a Jordan arc. ^thm-upper-boundary-is-jordan-arc

__Theorem [cap-from-upper-boundary].__ We have $p_{\delta K}$ and $p_K$ matching on the domain $\Theta \cup \Theta + \pi/2$. Consequently, $\mathcal{C} (\delta K) = \mathcal{C}(K)$. ^thm-cap-from-upper-boundary
%%

We define the _arm lengths_ of a cap $K$.

> __Definition [cap-tangent-arm-length].__ For any $t \in \Theta$, let $g_K^+(t)$ be the real value such that $\mathbf{y}_K(t) = A^+_K(t) + g_K^+(t) v_t$. Let $g_K^-(t)$ be the value such that $\mathbf{y}(t) = A^-_K(t) + g_K^-(t) v_t$. Let $h_K^+(t)$ be the value such that $\mathbf{y}(t) = C^+_K(t) + h_K^+(t) u_t$. Let $h_K^-(t)$ be the value such that $\mathbf{y}(t) = C^-_K(t) + h_K^-(t) u_t$. ^def-cap-tangent-arm-length

It turns out that when $\Theta = [0, \omega]$, the inner corner $\mathbf{x}_K(t)$ on $\Theta$ is both left and right differentiable. Also, the differentiation can be expressed in terms of the arm lengths of $K$.

> __Definition [inner-corner-deriv].__ For any cap $K \in \mathcal{K}_\omega$, $\mathbf{v}_K^+ (t)$ is the right derivative of $\mathbf{x}$ at $t$ and $\mathbf{v}_K^- (t)$ is the left derivative of $\mathbf{x}$ at $t$. ^def-inner-corner-deriv
$$
\mathbf{v}_K^{-} (t_0) = \lim_{t \rightarrow t_0^-} \frac{\mathbf{x}(t) - \mathbf{x}(t_0)}{t - t_0} \qquad
\mathbf{v}_K^{+} (t_0) = \lim_{t \rightarrow t_0^+} \frac{\mathbf{x}(t) - \mathbf{x}(t_0)}{t - t_0}.
$$

> __Theorem [inner-corner-deriv].__ For any cap $K \in \mathcal{K}_\omega$, $\mathbf{v}_K^+ (t)$ exists for any $0 \leq t < \omega$ and is equal to the following. ^thm-inner-corner-deriv
$$
\begin{align*}
	\mathbf{v}_K^+(t) = -(g_K^+(t) - 1) \cdot u_t + (h_K^+(t) - 1) \cdot v_t
\end{align*}
$$
> Likewise, $\mathbf{v}_K^- (t)$ exists for all $0 < t \leq \omega$ and is equal to the following.
$$
\begin{equation*}
	\mathbf{v}_K^-(t) = -(g_K^-(t) - 1) \cdot u_t + (h_K^-(t) - 1) \cdot v_t
\end{equation*}
$$

_Proof._ Fix an arbitrary cap $K$ and omit the subscript $K$. Take any $0 \leq t < \pi / 2$ and set $s = t + \delta$ for sufficiently small and arbitrary $\delta > 0$. We simplify $\mathbf{v}^+(t) = \lim_{\delta \rightarrow 0^+}(\mathbf{x}(s) - \mathbf{x}(t)) / \delta$.

Define $A_{t, s} = a(t) \cap a(s)$. Since $A_{t, s}$ is on the lines $a(t)$ and $a(s)$, it satisfies both 
$$
A_{t, s} \cdot u_t = \mathbf{x}(t) \cdot u_t + 1
$$ and
$$
A_{t, s} \cdot u_s = \mathbf{x}(s) \cdot u_s + 1.
$$

Rewrite $u_s = \cos \delta \cdot u_t + \sin \delta \cdot v_t$ on the second equation and we have
$$
\begin{align*}
	A_{t, s} \cos \delta \cdot u_t + A_{t, s} \sin \delta \cdot v_t =  	\cos \delta (\mathbf{x}(s) \cdot u_t) + \sin \delta (\mathbf{x}(s) \cdot v_t) + 1.
\end{align*}
$$
Group by $\cos \delta$ and $\sin \delta$ and substitute $A_{t, s} \cdot u_t$ with first equation then
$$ \cos \delta (\mathbf{x}(s) \cdot u_t - \mathbf{x}(t) \cdot u_t) + (1 - \cos \delta)
	= \sin \delta (A_{t, s}  (s) \cdot v_t - \mathbf{x}(s) \cdot v_t) .
	$$
Divide by $\delta$ and send $\delta \to 0^+$. Observe that $A_{t, s} \to A^+(t)$. We get
$$ \mathbf{v}^+(t) \cdot u_t  = (A^+(t) - \mathbf{x}(t)) \cdot v_t$$
Note that $g^+(t) = (\mathbf{y}(t) - A^+(t)) \cdot v_t = (\mathbf{x}(t) - A^+(t))\cdot v_t + 1$ so we have 
$$ \mathbf{v}^+(t) \cdot u_t = 1 - g ^+(t).$$
A similar argument can be applied to show $\mathbf{v}^+(t) \cdot v_t = h^+(t) - 1$ and thus the first equation of the theorem.  A symmetric argument shows the second equation of the theorem. □

> __Corollary [inner-corner-deriv-exists-almost-everywhere].__ For any cap $K$, $\mathbf{v}_K^+ (t) = \mathbf{v}_K^-(t)$ for all $0 < t < \pi / 2$ except for a countable number of values of $t$. Denote by $\mathbf{v}_K(t)$ the almost-everywhere defined derivative of $\mathbf{x}_K(t)$. Consequently, $\mathbf{x}_K$ is continuous and differentiable almost everywhere, and so $\mathbf{x}_K$ is absolutely continuous with $d \mathbf{x}_K = \mathbf{v}_K$. ^cor-inner-corner-deriv-exists-almost-everywhere

_Proof._ The boundary measure $\beta_K$ is a locally finite measure, so there are at most countable values of $t \in S^1$ where $\beta_K\left( \left\{ t \right\} \right)$ is not zero. By [[03. Geometric Results#^thm-boundary-measure]], we have $v^+_K(t) = v^-_K(t)$ whenever $\beta_K\left( \left\{ t \right\} \right) = 0$. So for such values, we have $g^+_K(t) = g^-_K(t)$ and $h^+_K(t) = h^-_K(t)$ by [[#^def-cap-tangent-arm-length]]. Using the formula in [[#^thm-inner-corner-deriv]], we obtain $\mathbf{v}_K^+ (t) = \mathbf{v}_K^-(t)$ for such $t$. □