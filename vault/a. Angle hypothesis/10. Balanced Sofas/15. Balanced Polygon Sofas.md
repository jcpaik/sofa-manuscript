In this [[a. Angle hypothesis/10. Balanced Sofas/15. Balanced Polygon Sofas|15. Balanced Polygon Sofas]], we show that the maximizing polygon cap $K \in \mathcal{K}_\Theta$ of the polygon sofa area $\mathcal{A}_\Theta(K)$ is _balanced_ in the sense of Gerver in [[a. Angle hypothesis/10. Balanced Sofas/15. Balanced Polygon Sofas#^thm-balanced-polygon-sofa]].

The main idea is to use the balancing argument as described in [[a. Angle hypothesis/01. Introduction/05. Balancedness]]. We circumvented the issue of preserving the connectedness by separtating the cap $K \in \mathcal{K}_\Theta$ from its polygon niche $\mathcal{N}_\Theta(K)$ in our polygon sofa area functional $\mathcal{A}_\Theta(K) = |K| - |\mathcal{N}_\Theta(K)|$. Consequently, we need to take account of both the cap $K$ and the niche $\mathcal{N}_\Theta(K)$ in our balancing strategy. Use support function $h = p_K$ as the controller for cap $K$ and niche $\mathcal{N}(K)$.

Let $\Theta^* := \Theta \cup (\Theta + \pi/2)$. Then the support function $h = p_K$ of the cap $K$ restricted to the set $\Theta^*$ determines the cap ^eqn-cap-support-ftn
$$
K = \bigcap_{t \in \Theta^*} H^-(t, h(t))
$$
and the polygon niche ^eqn-niche-support-ftn
$$
\mathcal{N}_{\Theta}(K) = H_-(\omega + \pi, h(\omega + \pi)) \cap H_-(3\pi/2, h(3\pi/2)) \cap
\bigcup_{t \in \Theta} \left( H_-^{\circ}(t, h(t) - 1) \cap H_-^\circ(t + \pi/2, h(t + \pi/2) - 1) \right) 
$$
completely. More specifically, they are Nef polygons determined by the hyperplanes with angle $t \in \Theta^*$ and distance $h(t)$ or $h(t) - 1$ from the origin. So the area functional $\mathcal{A}_\Theta(K)$ is a function of the support function $h : \Theta^* \to \mathbb{R}$.

Assume that $K$ is not balanced. We now execute the balancing strategy by tweaking the individual values of $h : \Theta^* \to \mathbb{R}$ to $h'$ and make the corresponding area functional $|K| - |\mathcal{N}_{\Theta}(K)|$ larger. The issue is that, as we tweak the values of $h$ to $h'$, there might not be a corresponding cap $K' \in \mathcal{K}_\Theta$ such that $h'$ is the support function $p_{K'}$. We circumvent this issue by carefully choosing the direction of push, so that after the push the new intersection $K'$ is always a cap as well.


- Prove the adjustment argument.
	- There exists a _positive_ direction in which a progression of $h$ give a larger area functional.
	- After such positive progression, the intersection $\mathcal{C}(h)$ coming from $h$ is also a proper translated cap.
		- non-band move -> set only gets larger
		- band move -> upper part positive -> still tight. lower part
	- $\mathcal{N}_\Theta(h) \subseteq \mathcal{N}_\Theta(K)$ where $K = \mathcal{C}(h)$.

- pushout -> preserves cap.
- The upper boundary $\delta K$ is a sequence of segments (some length zero) from left to right, connecting $C_K^+(\omega)$ to $A_K^-(0)$.
- The boundary of $\mathcal{N}(K)$ is a polyline $\mathbf{p}_K$, from left to right, connecting $C_K^+(\omega)$ to $A_K^-(0)$.
	- Need wedge gap.
- The contribution of $l(\pi/2, 0)$ on $\mathbf{p}_K$ is exactly $\sigma_K(3\pi/2) - \nu_K(3\pi/2)$. 
	- Wedge gap is a lower bound for it.
-  outer edges of K <= inner edges of niche => should be that the outer edge of something is strictly larger. for the 'bands', 



> __Definition [height-side-length].__ For any $t \in \Theta^*$, let $\sigma_h(t)$ be the side length $\lambda^1(\partial \mathcal{C}(h) \cap l(t, h(t)))$ of $\mathcal{C}(h)$, and let $\nu_h(t)$ be the side length $\lambda^1(\partial \mathcal{N}(h) \cap l_h(t))$ of $\mathcal{N}(h)$. ^def-height-side-length

# Extensions of the Cap Space

> __Definition [cap-trans-space].__ Let $\Theta$ be any angle set with rotation angle $\omega \in (0, \pi/2]$. Define $\mathcal{K}_\Theta'$ as the collection of all _translated caps_ where each $K' \in \mathcal{K}_\Theta'$ is an arbitrary translation of some cap $K \in \mathcal{K}_\Theta$. ^def-cap-trans-space

We immediately get $\mathcal{K}_\Theta \subseteq \mathcal{K}_\Theta'$.

> __Proposition [cap-trans-space].__ A convex polygon $K'$ is in $\mathcal{K}_\Theta'$ if and only if the followings are true. ^pro-cap-trans-space
> 
> 1. $K$ is a convex polygon with normal angles in the set $\Theta \cup (\Theta + \pi/2) \cup \left\{ \pi + \omega, 3\pi/2 \right\}$.
> 2. The widths $p_K(\omega) + p_K(\omega + \pi)$ and $p_K(\pi/2) + p_K(3\pi/2)$ of $K$ measured along the angles $\omega$ and $\pi/2$ are exactly one.

> __Definition [height-space].__ For any angle set $\Theta$, define $\mathcal{H}_\Theta$ as the space of all functions $h : \Theta \cup (\Theta + \pi/2) \to \mathbb{R}$. ^def-height-space

> __Proposition [height-space-embedding].__ The map $p_- : \mathcal{K}_\Theta' \to \mathcal{H}_\Theta$ mapping $K$ to its support function $p_K$ restricted to $\Theta \cup (\Theta + \pi/2)$ is a well-defined injection. ^pro-height-space-embedding

We now have a sequence of injections $\mathcal{K}_\Theta \to \mathcal{K}_\Theta' \to \mathcal{H}_\Theta$. The space $\mathcal{H}_\Theta$ is the most extended space where the movement of each $h(t)$ is free. We will extend the polygon area functional $\mathcal{A}_\Theta$ on $\mathcal{K}_\Theta$ to to a larger space $\mathcal{H}_\Theta$. The cap and niche of a cap generalizes naturally to an arbitrary function $h \in \mathcal{H}_\Theta$. We only need to follow [[a. Angle hypothesis/10. Balanced Sofas/15. Balanced Polygon Sofas#^eqn-cap-support-ftn]] and [[a. Angle hypothesis/10. Balanced Sofas/15. Balanced Polygon Sofas#^eqn-niche-support-ftn]].

> __Definition [height-fan].__ For any $h \in \mathcal{H}_\Theta$, define its _fan_ ^def-height-fan
$$
F_h = H_+(\omega, h(\omega) - 1) \cap H_+(\pi/2, h(\pi/2) - 1).
$$
> Correspondingly, for any translated cap $K' \in \mathcal{K}_\Theta'$ with support function $h = p_{K'} \in \mathcal{H}_\Theta$, define its _fan_ $F_{K'} = F_h$ and _niche_ $\mathcal{N}_\Theta(K') = \mathcal{N}_\Theta(h)$.

> __Definition [height-cap].__ For any $h \in \mathcal{H}_\Theta$, define its _cap_ ^def-height-cap
$$
\mathcal{C}(h) = F_h \cap \bigcap_{t \in \Theta \cup (\Theta + \pi/2)} H_-(t, h(t)).
$$

> __Definition [height-niche].__ For any $h \in \mathcal{H}_\Theta$, define its _niche_ ^def-height-niche
$$
\mathcal{N}_{\Theta}(h) = F_h \cap \bigcup_{t \in \Theta } \left( H_-^\circ(t, h(t)) \cap H_-^\circ(t + \pi/2, h(t + \pi/2)) \right) .
$$

If $h \in \mathcal{H}_\Theta$ is the support function $p_K$ of some extended cap $K \in \mathcal{K}_\Theta'$, then taking the cap $\mathcal{C}(h)$ of $h$ retrieves the original cap $K$ back.

> __Proposition [height-cap-niche-back].__ For any extended cap $K \in \mathcal{K}_\Theta'$ and its support function $h = p_K$, we have $\mathcal{C}(h) = K$. ^pro-height-cap-niche-back

If the function $h = p_K$ originates from some cap $K \in \mathcal{K}_\Theta$, then $\mathcal{N}_\Theta(h)$ retrieves the polygonal niche $\mathcal{N}_\Theta(K)$.

> __Proposition [height-niche-back].__ For any cap $K \in \mathcal{K}_\Theta$ and its support function $h = p_K$, we have $\mathcal{N}_\Theta(h) = \mathcal{N}_\Theta(K)$. ^pro-height-niche-back

Using the generalizations of cap and niche, the polygon sofa area functional $\mathcal{A}_\Theta(K)$ on a cap also generalizes to $h \in \mathcal{H}_\Theta$.

> __Definition [polygon-sofa-area].__ For any $h \in \mathcal{H}_\Theta$, define its sofa area functional $\mathcal{A}_\Theta(h) = |\mathcal{C}(h)| - |\mathcal{N}_\Theta(h)|$. Correspondingly, for any extended cap $K' \in \mathcal{K}_\Theta'$ with support function $h = p_{K'}$, define $\mathcal{A}_\Theta(K')$ = $\mathcal{A}_\Theta(h)$. ^def-polygon-sofa-area

> __Proposition [polygon-sofa-area].__ For any cap $K \in \mathcal{K}_\Theta$ and $h = p_K$, we have $\mathcal{N}_\Theta(h) = \mathcal{N}_\Theta(K)$. ^pro-polygon-sofa-area

> __Definition [cap-balanced].__ Say that a cap $K \in \mathcal{K}_\Theta$ is _balanced_ if the following conditions are true. ^def-height-balanced
> 
> 1. $\kappa_h(t) = \nu_h(t)$ for all $t \in \Theta \cup (\Theta + \pi/2) \setminus \left\{ \omega, \pi/2 \right\}$.
> 2. If $\omega < \pi/2$, then $\kappa_h(3\pi/2) - \nu_h(3\pi/2) = \kappa_h(\pi/2)$ and $\kappa_h(\omega + \pi) - \nu_h(\omega + \pi) = \kappa_h(\omega)$.
> 3. If $\omega = \pi/2$, then $\kappa_h(3\pi/2) - \nu_h(3\pi/2) = \kappa_h(\pi/2)$.

> __Proposition [not-balanced-positive-direction].__ Assume that a cap $K \in \mathcal{K}_\Theta$ is _not_ balanced. Then 
> ^pro-not-balanced-positive-direction

# Wedge Gap

We need to define the wedge gap $w_K^{\circ}$ and $z_K^{\circ}$ carefully.

> __Definition [wedge-gap-polygon].__ Let the cap $K \in \mathcal{K}_\Theta$ be arbitrary. Define its _right wedge gap_ $w_K^{\circ} := \min_{t \in \Theta \setminus \left\{ \pi/2 \right\}} w_K(t)$ and _left wedge gap_ $z_K^{\circ} := \min_{t \in \Theta \setminus \left\{\omega -  \pi/2 \right\}} z_K(t)$. ^def-wedge-gap-polygon

The weird subtraction by $\pi/2$ or $\omega - \pi/2$ in the definition of $w_K^{\circ}$ and $z_K^{\circ}$ is only affected by the rotation angle $\omega = \pi/2$. The reason is that, if $\omega = \pi/2$, then the wedge gap $w_K(\pi/2)$ is not well-defined because the lines $b_K(t)$ and $l_K(3\pi/2)$ are parallel so their intersection $W_K(t)$ is not well-defined.

Recall that for a cap $K \in \mathcal{K}_\Theta$, the wedge gap is strictly positive (existing theorem). For an extended cap, the situation is a little bit different.

> __Definition [further-in-direction].__ Say that a point $p_1$ is _further than_ (resp. _strictly further than_) the point $p_2$ _in the direction_ of nonzero vector $v \in \mathbb{R}^2$ if $p_1 \cdot v \geq p_2 \cdot v$ (resp. $p_1 \cdot v > p_2 \cdot v$). ^def-further-in-direction

(State and prove strict positivity of $w_K^{\circ}$ again)

The wedge gap $w_K^{\circ}$ provides a lower bound for the difference between the lengths $\sigma_K(3\pi/2)$, $\nu_K(3\pi/2)$ of the bottom edges of cap and niche.

> __Lemma [height-gap].__ The followings are true for any cap $K \in \mathcal{K}_\Theta$ with rotation angle $\omega$. ^lem-height-gap
> 
> - If $\omega < \pi/2$, then $\nu_K(3\pi/2) + w_K^{\circ} \leq \sigma_K(3\pi/2)$ and $\nu_K(\omega + \pi) + z_K^{\circ} \leq \sigma_K(\omega + \pi)$. 
> - If $\omega = \pi/2$ and $\sigma_K(3\pi/2) \geq 2$, then $w_K^{\circ} + \nu_K(3\pi/2) + z_K^{\circ} \leq \sigma_K(3\pi/2)$.

_Proof._ Assume first that $\omega < \pi/2$. $\nu_K(3\pi/2)$ is the side length $\lambda^1(\partial \mathcal{N}(K) \cap l_K(3\pi/2))$ of $\mathcal{N}(K)$. Need to examine the side $s = \partial \mathcal{N}(K) \cap l_K(3\pi/2)$. 

Since $\mathcal{N}(K)$ is the union of wedges $\bigcup_{t \in \Theta} T_K(t)$, $s$ is inside the union of $\bigcup_{t \in \Theta} \partial T_K(t) \cap l_K(3\pi/2)$. Each set $\partial T_K (t) \cap l_K(3\pi/2)$ is, by case analysis, empty or contained in a line segment $s_t$ from $o_K$ to the point $W_K(t)$ on the right of $o_K$. If all sets are empty, then $\nu_K(3\pi/2) = 0$ and we get $w_K^{\circ} \leq \sigma_K(3\pi/2)$ by the mere definition. Otherwise, $s$ is contained in $s_t$ for some $t \in \Theta$, where $s_t$ connects $o_K$ to $W_K(t)$ to the right. $w_K^{\circ} \leq w_K(t)$, and $w_K(t)$ is the signed distance from $W_K(t)$ to $A_K^-(0)$. $\sigma_K(3\pi/2)$ is the signed distance from $o_K$ to $A_K^-(0)$. Now the result follows.

Now prove the case $\omega = \pi/2$. Again, $s = \partial \mathcal{N}(K) \cap l_K(3\pi/2)$. Since $\mathcal{N}(K)$ is the union of wedges $\bigcup_{t \in \Theta} T_K(t)$, $s$ is inside the union of $\bigcup_{t \in \Theta} \partial T_K(t) \cap l_K(3\pi/2)$. Each set $s_t = \partial T_K (t) \cap l_K(3\pi/2)$ is, by case analysis, empty or a line segment from $Z_K(t)$ to $W_K(t)$ in the right direction.

- If every $s_t$ is empty, then $s$ itself is empty. So $\nu_K(3\pi/2) = 0$. $w_K^{\circ} + z_K^{\circ} \leq 2 \leq \sigma_K(3\pi/2)$.
- If some $s_t$ is nonempty, then among all points $Z_K(t)$ and $W_K(t)$ over $t \in \Theta$, $Z_K(t_1)$ is the leftmost and $W_K(t_2)$ is the rightmost and $W_K(t_2)$ is strictly on the right side of $Z_K(t_1)$. Now $w_K^{\circ} \leq$ the signed length from $Z_K(t_1)$ to $C_K^+(\pi/2)$ in the left direction. $z_K^{\circ} \leq$ the signed length from $W_K(t_2)$ to $A_K^-(0)$ in the right direction. The proof is complete. □

> __Theorem [polyline].__ Define the _polyline_ $\mathbf{p}_K$ of cap $K$ as the boundary of $F_\omega \setminus \mathcal{N}_\Theta(K)$. Then $\mathbf{p}_K$ has the following structure. ^thm-polyline
> 
> - It consists of the half-line starting from $C_K^+(\omega)$ in the direction of $v_\omega$.
> - An $x$-monotone _polyline_ $\mathbf{p}_K$ connecting $C_K^+(\omega)$ to $A_K^-(0)$ from left to right, with each line segment of normal angle in $\Theta \cup (\Theta + \pi/2)$.
> - It ends with the half-line from $A_K^-(0)$ in the direction of $u_0$.

> __Definition [polyline].__ Define the polyline $\mathbf{p}_K$ in [[a. Angle hypothesis/10. Balanced Sofas/15. Balanced Polygon Sofas#^thm-polyline]] as the _polyline of cap_ $K \in \mathcal{K}_\Theta$. ^def-polyline

> __Definition [polyline-length].__ Let $\nu_K(t)$ be the sum of the length of the edges in $\mathbf{p}_K$ with normal angle $t$.
> ^def-polyline-length

The sum of lengths $\nu_K(t)$ measures the contribution of each line to the boundary of $\mathcal{N}_\Theta(K)$.

> __Proposition [polyline-length].__ ^pro-polyline-length
> 
> 1. For any $t \in \Theta \setminus \left\{ \omega \right\}$, we have $\nu_K(t) = \lambda^1 \left( \partial \mathcal{N}(K) \cap b_K(t) \right)$.
> 2. For any $t \in \Theta \setminus \left\{ 0 \right\}$, we have $\nu_K(t + \pi/2) = \lambda^1 \left( \partial \mathcal{N}(K) \cap d_K(t) \right)$.
> 3. $\nu_K(\omega) + \lambda^1\left( \overline{\mathcal{N}(K)} \cap l(\omega, 0) \right) = \sigma_K(\omega + \pi)$.
> 4. $\nu_K(\pi/2) + \lambda^1$ 

