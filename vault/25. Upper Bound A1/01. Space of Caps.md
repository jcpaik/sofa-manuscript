In [[15. Sofa Area Functional#^con-gerver-cap]], we turned the moving sofa problem into optimization of the sofa area functional $\mathcal{A} : \mathcal{K}_\omega \to \mathbb{R}$ on the space of caps $\mathcal{K}_\omega$. Our main observation here is that the space of caps $\mathcal{K}_\omega$ is a _convex space_.

In general, a set $\mathcal{K}$ is a convex space if it is equipped with a convex combination operation $c_\lambda(-, -) : \mathcal{K} \times \mathcal{K} \to \mathcal{K}$ for every $\lambda \in [0, 1]$ such that it satisfies a set of axioms matchiing the properties of convex-linear combination in a real vector space (e.g. axioms 1-4 of [[@nlab-convex-space]]). Any real vector space $V$ is a convex space with $c_\lambda(v_1, v_2) = (1 - \lambda) v_1 + \lambda v_2$. For the space of caps $\mathcal{K}_\Theta$, define their convex combination as $c_\lambda(K_1, K_2) = (1-\lambda) K_1 + \lambda K_2$ using the Minkowski sum. Then it is rountine to check that the combination is also a cap with rotation angle $\omega$, and that the combination satisfies the axioms of convex space. We will use that $\mathcal{K}_\omega$ is a convex space to invoke calculus of variation on the sofa area functional $\mathcal{A} : \mathcal{K}_\omega \to \mathbb{R}$ in later parts.

# Linear and Quadratic Functional

In general, a function $f : \mathcal{K} \to V$ from a convex space $\mathcal{K}$ to a convex space $V$ is _convex-linear_ if $f(c_\lambda(K_1, K_2)) = c_\lambda(f(K_1), f(K_2))$ for all $K_1, K_2 \in \mathcal{K}$ and $\lambda \in [0, 1]$. Call a functional $f : \mathcal{K} \to \mathbb{R}$ on $\mathcal{K}$ a _linear functional_ on $\mathcal{K}$ if it is convex-linear. Many values on the cap $K \in \mathcal{K}_\omega$ are convex-linear. The support function $p_K$ is convex-linear with respect to $K \in \mathcal{K}_\omega$. For an arbitrary angle $t \in S^1$, the vertices $A_K^+(t), A_K^-(t), C_K^+(t), C_K^-(t)$ ([[15. Sofa Area Functional#^def-cap-vertices]]) are all convex-linear with respect to $K \in \mathcal{K}_\omega$. Likewise, the corners $\mathbf{x}_K(t)$ and $\mathbf{y}_K(t)$ are convex-linear with respect to $K \in \mathcal{K}_\omega$.

In this paper, for a convex space $\mathcal{K}$ call a function $g : \mathcal{K} \times \mathcal{K} \to \mathbb{R}$ _convex-bilinear_ if the maps $g(K_1, -)$ and $g(-, K_2)$ are convex-linear for any $K_1, K_2 \in \mathcal{K}$. Call a functional $h : \mathcal{K} \to \mathbb{R}$ a _quadratic functional_ on $\mathcal{K}$ if $h(K) = g(K, K)$ for some convex-bilinear function $g$. Note that in our definition, a linear functional $f$ on $\mathcal{K}$ is also quadratic because $f(K) = g(K, K)$ where $g(K_1, K_2) = f(K_1)$ is convex-bilinear. The sofa area functional $\mathcal{A}(K)$ is very likely not a quadratic functional with respect to $K \in \mathcal{K}_\omega$. But we will soon construct upper bounds $\mathcal{A}_1$ and $\mathcal{A}_2$ of $\mathcal{A}$ that are quadratic functionals on $\mathcal{K}_\omega$. We will show that $\mathcal{A}_1$ and $\mathcal{A}_2$ are concave using the following criterion.

> __Theorem [quadratic-concave].__ Let $f$ be a quadratic functional on a convex space $\mathcal{K}$ with convex combination $c_\lambda(-, -)$ for all $\lambda \in [0, 1]$. If there is a linear functional $g : \mathcal{K} \to \mathbb{R}$ and a convex-linear map $h : \mathcal{K} \to V$ to a real vector space $V$ with inner product $\left< -, - \right>_V$ such that $f(K) = g(K) - \left< h(K), h(K) \right>_V$ for every $K \in \mathcal{K}$, then $f$ is a concave function on $\mathcal{K}$. ^thm-variation-maximizer

_Proof._ It suffices to show the case where $g = 0$. Then in the general case, $f - g$ is a concave function on $\mathcal{K}$ so consequently $f$ is also concave. For the case $g = 0$, take arbitrary $K_1, K_2 \in \mathcal{K}$. Fixing $K_1$ and $K_2$, observe that $f(c_\lambda(K_1, K_2))$ is a concave quadratic polynomial with respect to $\lambda \in [0, 1]$ by expanding the term. □

Then finding the global maximum of quadratic and concave upper bounds $\mathcal{A}_1$ and $\mathcal{A}_2$ can be done by calculus of variation as the following.

> __Theorem [variation-maximizer].__ Let $f$ be a concave quadratic functional on a convex space $\mathcal{K}$ with convex combination $c_\lambda(-, -)$ for all $\lambda \in [0, 1]$. Then $K_1 \in \mathcal{K}$ attains the global maximum of $f$ if and only if for any $K_2 \in \mathcal{K}$ we have $\left. \frac{d}{d\lambda} \right|_{\lambda = 0} f(c_\lambda(K_1, K_2)) \leq 0$. ^thm-variation-maximizer

_Proof._ Let $K = c_\lambda(K_1, K_2)$. If $K_1$ is indeed a maximizer of $f$, then the value $f(K)$ should attain its maximum at $\lambda = 0$ so the result $\left. \frac{d}{d\lambda} \right|_{\lambda = 0} f(K) \leq 0$ follows. Now we show that whenever $\left. \frac{d}{d\lambda} \right|_{\lambda = 0} f(K) \leq 0$ for any $K_2$, then $K_1$ is a maximizer. Assume otherwise that there is some $K_2$ such that $f(K_2) > f(K_1)$. Then we have $f(K) \geq (1-\lambda) f(K_1) + \lambda f(K_2)$ by concavity of $f$. □

# Surface Area Measure

An important value of a convex body $K$ is its _surface area measure_ $\beta_K$ on the circle $S^1$. If $K$ is a convex polygon, then $\beta_K$ is a discrete measure such that the side of $K$ of length $l$ with normal vector $u_t$ corresponds in $\beta_K$ to a point mass of $l$ concentrated on the point $t$. For example, if $K = [0, 1]^2$ is a unit circle then $\beta_K$ has support $\left\{ 0, \pi/2, \pi, 3\pi/2 \right\}$ with each point having a mass equal to 1. If the tangent line $l_K(t)$ touches $K$ at a single point $v_K(t)$ and $v_K(t)$ is continuously differentiable with respect to $t$, then we have $\beta_K(dt) = \left\lVert v'(t) \right\rVert dt$.  For example, if $K$ is a disk with radius 1, then $\beta_K$ is the Lebesgue measure on $S^1 = \mathbb{R} / 2 \pi \mathbb{Z}$.

The measure $\beta_K$ is convex-linear with respect to $K$ (e.g. from (5.27), p284 of [[@schneider_2013]] and that in dimension $n=2$ the mixed area measure is equal to the surface area measure). Moreover, we have ^eqn-mixed-area
$$
V(K_1, K_2) = \left< p_{K_1}, \beta_{K_2} \right>_{S^1} / 2
$$
where $V(K_1, K_2)$ is the mixed volume of arbitrary convex bodies $K_1$ and $K_2$ (Theorem 5.1.7, p280 of [[@schneider_2013]]), so we have ^eqn-area
$$
|K| = \left< p_K, \beta_K \right>_{S^1} / 2
$$
for any convex body $K$ in particular. Thus the area $|K|$ of a cap $K \in \mathcal{K}_\omega$ is a quadratic functional on $\mathcal{K}_\omega$.

Gauss-Minkowski theorem states that any convex set $K$, up to translation, corresponds one-to-one to a measure $\beta = \beta_K$ on $S^1$ such that $\int_{S^1}u_t\,\beta(dt) = 0$. Using this correspondence, we establish a correspondence between any cap $K \in \mathcal{K}_\omega$ and its boundary measure $\beta_K$.

> __Theorem [boundary-measure-cap].__ For any cap $K$ with rotation angle $\omega$ and angle set $\left\{ 0, \omega \right\} \subseteq \Theta \subseteq [0, \omega]$, the boundary measure $\beta_K$ of $K$ on $S^1$ has support in $\Theta \cup (\Theta + \pi/2) \cup \{\pi + \omega, 3\pi/2\}$ and satisfies the followings. ^thm-boundary-measure-cap
$$
\int_{t \in \Theta} \cos(t) \, \beta_K(dt) = 1 \qquad \int_{t \in \Theta + \pi/2} \cos\left( \omega + \pi/2 - t \right)  \, \beta_K(dt) = 1
$$

_Proof._ $\beta_K$ has support in $\Theta \cup (\Theta + \pi/2) \cup \{\pi + \omega, 3\pi/2\}$ by the second condition of . We have $\left( A^+_K(\omega) - A^-_K(0) \right) \cdot v_0 = 1$ because for a cap $K$, the point $A_K^+(\omega)$ is on the line $l_K(\pi/2)$ which is $y=1$, and $A_K^-(0)$ is on the line $y=0$. So by xxx, we get the first equation. The second equation can be obtained by a symmetric argument. □

> __Theorem [cap-from-boundary-measure].__ Conversely to [[#^thm-boundary-measure-cap]], let $\beta$ be a measure on $\Theta \cup (\Theta + \pi/2)$ that satisfies the following equations. ^thm-cap-from-boundary-measure
$$
\int_{t \in \Theta} \cos(t) \, \beta(dt) = 1 \qquad \int_{t \in \Theta + \pi/2} \cos\left( \omega + \pi/2 - t \right)  \, \beta(dt) = 1
$$
> Then the followings hold.
> 
> - If $\omega = \pi/2$, then there is a cap $K$ with rotation angle $\omega$ and angle set $\Theta$ such that $\beta_K|_{\Theta \cup (\Theta + \pi/2)} = \beta$. This is unique up to horizontal translation: all the other caps $K'$ satisfying the same condition is a horizontal translation of $K$.
> - If $\omega < \pi/2$, then there is a unique cap $K$ with rotation angle $\omega$ and angle set $\Theta$ such that $\beta_K|_{\Theta \cup (\Theta + \pi/2)} = \beta$.

_Proof._ We first observe that there is a unique extension of $\beta$ on the set $\Pi = \Theta \cup (\Theta + \pi/2) \cup \{\pi + \omega, 3\pi/2\}$ such that $\int_{t \in \Pi} v_t \, \beta(dt) = 0$. Let $A = \int_{t \in \Theta}\sin(t)\,\beta(dt) \geq 0$, then we have $\int_{t \in \Theta} v_t \,\beta(dt) = - A u_0 + v_0$ by the first condition. Likewise, if we let $B = \int_{t \in \Theta + \pi / 2} \sin(\omega + \pi/2 - t)\,\beta(dt) \geq 0$, then we have $\int_{t \in \Theta + \pi/2}v_t\,\beta(dt) = B v_\omega - u_\omega$. By solving for $\int_{t \in \Pi} v_t \, \beta(dt) = 0$, we get the unique extension of $\beta$ on the points $\pi + \omega$ and $3\pi/2$ as the followings.

- If $\omega = \pi/2$, then $\beta(\left\{ \pi + \omega \right\}) = \beta(\left\{ 3\pi / 2 \right\}) = \int_{t \in \Theta \cup \Theta + \pi/2} \sin(t) \, \beta(dt) \geq 0$
- If $\omega < \pi/2$, then $\beta(\left\{ \pi + \omega \right\}) = B + v_\omega \cdot p_\omega > 0$ and $\beta(\left\{ 3 \pi/2 \right\}) = A + u_0 \cdot p_\omega \geq 0$.

Now we use [[yy. Geometric Results#^thm-supported-gauss-measure]]. If $\omega = \pi/2$, then there is a unique convex body $K$ up to translation so that $\beta_K = \beta$ on $\Pi$. The equations on $\beta$ imply that the width measured in the direction of $y$-axis is 1. So up to translation, the $K$ that is a cap ($p_K(\pi) = 1$ and $p_K(3\pi/2) = 0$) is unique up to horizontal translation. If $\omega < \pi/2$, then there is a unique convex body $K$ such that $\beta_K = \beta$ on $\Pi$ and $v_K^+(\omega) = p_\omega$. The equations on $\beta$ is equivalent to that $K$ has width 1 in the direction of $u_\omega$ and $v_0$. So this $K$ is a cap. □
