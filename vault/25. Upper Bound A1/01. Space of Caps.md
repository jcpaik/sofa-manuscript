In [[15. Sofa Area Functional#^con-gerver-cap]], we turned the moving sofa problem into optimizing the sofa area functional $\mathcal{A} : \mathcal{K}_\omega \to \mathbb{R}$ on the space of caps $\mathcal{K}_\omega$. Our main observation here is that the space of caps $\mathcal{K}_\Theta$ is a _convex space_. In general, a set $\mathcal{K}$ is a convex space if it is equipped with a convex combination operation $c_\lambda(-, -) : \mathcal{K} \times \mathcal{K} \to \mathcal{K}$ for every $\lambda \in [0, 1]$ such that it satisfies a set of axioms following the properties of convex-linear combination [[@nlab-convex-space]]. For the space of caps $\mathcal{K}_\Theta$, define their convex combination as $c_\lambda(K_1, K_2) = (1-\lambda) K_1 + \lambda K_2$ using the Minkowski sum. This makes the space $\mathcal{K}_\Theta$ amenable to calculus of variation that we will invoke in later parts. 

In general, a function $f : \mathcal{K} \to V$ from convex set $\mathcal{K}$ to convex or vector space $V$ is called _convex-linear_ if $f(c_\lambda(K_1, K_2)) = (1-\lambda) f(K_1) + \lambda f(K_2)$ for all $K_1, K_2 \in \mathcal{K}$ and $\lambda \in [0, 1]$. Likewise, a function $g : \mathcal{K} \times \mathcal{K} \to \mathbb{R}$ is _convex-bilinear_ if the maps $g(K_1, -)$ and $g(-, K_2)$ are convex-linear for any $K_1, K_2 \in \mathcal{K}$. In this paper, call a functional $h : \mathcal{K} \to \mathbb{R}$ a _quadratic functional_ on $\mathcal{K}$ if $h(K) = g(K, K)$ for some convex-bilinear function $g$. We define which quadratic functional is positive/negative semidefinite. 

> __Definition [positive-semidefinite-quadratic-functional].__ Let $\mathcal{K}$ be any convex space. A quadratic functional $f : \mathcal{K} \to \mathbb{R}$ is _positive semidefinite_ (resp. _negative semidefinite_) if, for any $K_1, K_2 \in \mathcal{K}$ and $K = c_\lambda(K_1, K_2)$ for arbitrary $\lambda \in [0, 1]$, the quadratic polynomial $f(K)$ of $\lambda$ has non-negative (resp. non-positive) quadratic coefficient. ^def-positive-semidefinite-quadratic-functional

Note that the vertices $A^+_K, A^-_K, C^+_K, C^-_K$ of cap and the corners $\mathbf{x}_K$ and $\mathbf{y}_K$ of the tangent hallway $L_K(t)$ are convex-linear with respect to $K$ by [[yy. Geometric Results#^thm-convex-body-linear]]. Let us define what is a quadratic functional on a convex space.

> __Theorem [variation-maximizer].__ Let $f$ be a concave quadratic functional on a convex space $\mathcal{K}$. Then $K_1 \in \mathcal{K}$ attains the global maximum of $f$ if and only if for any $K_2 \in \mathcal{K}$, if we let $K = c_\lambda(K_1, K_2)$ for any $\lambda \in [0, 1]$ then we have $\left. \frac{d}{d\lambda} \right|_{\lambda = 0} f(K) \leq 0$. ^thm-variation-maximizer

_Proof._ If $K_1$ is indeed a maimizer of $f$, then the value $f(K)$ should attain its maximum at $\lambda = 0$ so the result $\left. \frac{d}{d\lambda} \right|_{\lambda = 0} f(K) \leq 0$ follows. Now we show that whenever $\left. \frac{d}{d\lambda} \right|_{\lambda = 0} f(K) \leq 0$ for any $K_2$, then $K_1$ is a maximizer. Assume otherwise that there is some $K_2$ such that $f(K_2) > f(K_1)$. Then we have $f(K) \geq (1-\lambda) f(K_1) + \lambda f(K_2)$ by concavity of $f$.  □

For any cap $K$ with angle set $\Theta$, define the _area functional_ on $K$ as the following value.

> __Definition [area-functional].__ For any angle set $\Theta$, define the _area functional_ $\mathcal{A} : \mathcal{K}_\Theta \to \mathbb{R}$ on $K_\Theta$ as $\mathcal{A}(K) = |K| - |\mathcal{N}(K)|$. ^def-area-functional

We collect miscellenious results on the geometry of caps.

## Boundary Measure

We establish a correspondence between caps and its boundary measures. Let $K$ be an arbitrary cap in $\mathcal{K}_\Theta$ with angle set $\Theta$ and rotation angle $\omega \in [0, \pi/2]$.

> __Theorem [boundary-measure-cap].__ The boundary measure $\beta_K$ of $K$ on $S^1$ has support in $\Theta \cup (\Theta + \pi/2) \cup \{\pi + \omega, 3\pi/2\}$ and satisfies the followings. ^thm-boundary-measure-cap
$$
\int_{t \in \Theta} \cos(t) \, \beta_K(dt) = 1 \qquad \int_{t \in \Theta + \pi/2} \cos\left( \omega + \pi/2 - t \right)  \, \beta_K(dt) = 1
$$

_Proof._ $\beta_K$ has support in $\Theta \cup (\Theta + \pi/2) \cup \{\pi + \omega, 3\pi/2\}$ by [[yy. Monotone Sofas#^def-cap]]. We have $\left( A^+_K(\omega) - A^-_K(0) \right) \cdot v_0 = 1$ for any cap $K$, and by applying [[yy. Geometric Results#^thm-boundary-measure]] to the formula, we obtain the first equation. The second equation can be obtained by a symmetric argument. □

> __Theorem [cap-from-boundary-measure].__ Conversely to [[#^thm-boundary-measure-cap]], let $\beta$ be a measure on $\Theta \cup (\Theta + \pi/2)$ that satisfies the following equations. ^thm-cap-from-boundary-measure
$$
\int_{t \in \Theta} \cos(t) \, \beta(dt) = 1 \qquad \int_{t \in \Theta + \pi/2} \cos\left( \omega + \pi/2 - t \right)  \, \beta(dt) = 1
$$
> Then the followings hold.
> 
> - If $\omega = \pi/2$, then there is a cap $K$ with rotation angle $\omega$ and angle set $\Theta$ such that $\beta_K|_{\Theta \cup (\Theta + \pi/2)} = \beta$. This is unique up to horizontal translation: all the other caps $K'$ satisfying the same condition is a horizontal translation of $K$.
> - If $\omega < \pi/2$, then there is a unique cap $K$ with rotation angle $\omega$ and angle set $\Theta$ such that $\beta_K|_{\Theta \cup (\Theta + \pi/2)} = \beta$.

_Proof._ We first observe that there is a unique extension of $\beta$ on the set $\Pi = \Theta \cup (\Theta + \pi/2) \cup \{\pi + \omega, 3\pi/2\}$ such that $\int_{t \in \Pi} v_t \, \beta(dt) = 0$. Let $A = \int_{t \in \Theta}\sin(t)\,\beta(dt) \geq 0$, then we have $\int_{t \in \Theta} v_t \,\beta(dt) = - A u_0 + v_0$ by the first condition. Likewise, if we let $B = \int_{t \in \Theta + \pi / 2} \sin(\omega + \pi/2 - t)\,\beta(dt) \geq 0$, then we have $\int_{t \in \Theta + \pi/2}v_t\,\beta(dt) = B v_\omega - u_\omega$. By solving for $\int_{t \in \Pi} v_t \, \beta(dt) = 0$, we get the unique extension of $\beta$ on the points $\pi + \omega$ and $3\pi/2$ as the followings.

- If $\omega = \pi/2$, then $\beta(\left\{ \pi + \omega \right\}) = \beta(\left\{ 3\pi / 2 \right\}) = \int_{t \in \Theta \cup \Theta + \pi/2} \sin(t) \, \beta(dt) \geq 0$
- If $\omega < \pi/2$, then $\beta(\left\{ \pi + \omega \right\}) = B + v_\omega \cdot p_\omega > 0$ and $\beta(\left\{ 3 \pi/2 \right\}) = A + u_0 \cdot p_\omega \geq 0$.

Now we use [[yy. Geometric Results#^thm-supported-gauss-measure]]. If $\omega = \pi/2$, then there is a unique convex body $K$ up to translation so that $\beta_K = \beta$ on $\Pi$. The equations on $\beta$ imply that the width measured in the direction of $y$-axis is 1. So up to translation, the $K$ that is a cap ($p_K(\pi) = 1$ and $p_K(3\pi/2) = 0$) is unique up to horizontal translation. If $\omega < \pi/2$, then there is a unique convex body $K$ such that $\beta_K = \beta$ on $\Pi$ and $v_K^+(\omega) = p_\omega$. The equations on $\beta$ is equivalent to that $K$ has width 1 in the direction of $u_\omega$ and $v_0$. So this $K$ is a cap. □

%%
Summarizing the previous discussions, we have shown that any maximum sofa $S$ rotating by an angle of $\omega \in [0, \pi/2]$ can be assumed to be monotone with cap $K$ and angle set $[0, \omega]$ ([[yy. Monotone Sofas#^cor-monotonization-contains]] and [[yy. Monotone Sofas#^thm-monotonization-is-hallway-intersection]]). That is, $S = K \setminus \mathcal{N}(K)$ ([[yy. Monotone Sofas#^thm-monotonization-eq]]) where $K$ is the cap of $S$ and $\mathcal{N}(K)$ is the corresponding niche. With this, we will understand a maximum sofa $S$ by its cap $K$. In this subsection, we define the space $\mathcal{K}_\omega$ of all caps $K$ and analyze it.
%%