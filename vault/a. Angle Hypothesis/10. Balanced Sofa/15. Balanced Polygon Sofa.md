Following the outline in [[a. Angle Hypothesis/03. Outline/05. Balanced Sofa]], we define a polygon cap $K$ and its polygon niche $\mathcal{N}_\Theta(K)$ separately. 

> __Definition [angled-cap-space].__ Assume $\omega \in (0, \pi/2]$ and a nonempty finite subset $\Theta$ of $(0, \omega)$. Define the space $\mathcal{K}_\Theta$ of _polygon caps with angle set_ $\Theta$ as the subset of $\mathcal{K}_\omega$ of each $K \in \mathcal{K}_\Theta$ which is an intersection of closed half-planes with normal angles in $\Theta \cup (\Theta + \pi/2) \cup \left\{\omega, \pi/2,  \pi + \omega, 3\pi/2 \right\}$. ^def-angled-cap-space

Any cap $K \in \mathcal{K}_\omega$ can be approximated by a polygon cap $\mathcal{C}_\Theta(K) \in \mathcal{K}_\Theta$ containing $K$.

> __Definition [angled-cap].__ For any $K \in \mathcal{K}_\omega$, define the set ^def-angled-cap
$$
\mathcal{C}_\Theta(K) = P_\omega \cap \bigcap_{t \in \Theta} Q_K^+(t).
$$

> __Proposition [angled-cap].__ For any $K \in \mathcal{K}_\omega$, the set $\mathcal{C}_\Theta(K)$ is a member of $\mathcal{K}_\Theta$ containing $K$ as subset. Also, the map $\mathcal{C}_\Theta : \mathcal{K}_\omega \to \mathcal{K}_\Theta$ is a surjective map fixing the elements of $\mathcal{K}_\Theta$. ^pro-angled-cap

_Proof._ That $\mathcal{C}_\Theta(K) \in \mathcal{K}_\Theta$ comes from the formula in [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^def-angled-cap]]. That $K \subseteq \mathcal{C}_\Theta(K)$ comes from $K \subseteq P_\omega$ and $K \subseteq Q_K^+(t) = H_K(t) \cap H_K(t + \pi/2)$. Now it remains to show that for any $K \in \mathcal{K}_\Theta$, we have $\mathcal{C}_\Theta(K) = K$. Since $K \in \mathcal{K}_\Theta$ is the intersection of closed half-planes with normal angles in $\Pi := \Theta \cup (\Theta + \pi/2) \cup \left\{\omega, \pi/2,  \pi + \omega, 3\pi/2 \right\}$, we have $K = \bigcap_{t \in \Pi} H_K(t)$. As $K \in \mathcal{K}_\Theta \subset \mathcal{K}_\omega$, we have $p_K(\omega) = p_K(\pi/2) = 1$ and $p_K(\omega + \pi) = p_K(3\pi/2) = 0$ so $K = \bigcap_{t \in \Pi} H_K(t) = P_\omega \cap \bigcap_{t \in \Theta} Q_K^+(t) = \mathcal{C}_\Theta(K)$. □

> __Definition [angled-niche].__ For every polygon cap $K \in \mathcal{K}_\Theta$ with angle set $\Theta$, define its _polygon niche_ ^def-angled-niche
$$
\mathcal{N}_\Theta(K) = P_\omega \cap \bigcup_{t \in \Theta} Q_K^-(t).
$$

> __Definition [polygon-upper-bound].__ Let $\Theta$ be an angle set with rotation angle $\omega$. Define the _polygon upper bound_ $\mathcal{A}_\omega : \mathcal{K}_\Theta \to \mathbb{R}$ as $\mathcal{A}_\Theta(K) = |K'| - \mathcal{N}_\Theta(K')$ where $K' = \mathcal{C}_\Theta(K)$.
> ^def-polygon-upper-bound

> __Theorem [polygon-upper-bound].__ For every $K \in \mathcal{K}_\omega$, we have $\mathcal{A}(K) \leq \mathcal{A}_\Theta(K)$.
> ^thm-polygon-upper-bound

We will show that the maximizing polygon cap $K \in \mathcal{K}_\Theta$ of the polygon sofa area $\mathcal{A}_\Theta(K)$ is _balanced_ in the sense of Gerver ([[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^thm-balanced-polygon-sofa]]) by executing the balancing argument described in [[a. Angle Hypothesis/03. Outline/05. Balanced Sofa]]. We circumvent the issue that the balanced polygon sofa $S_\Theta := K \setminus \mathcal{N}_\Theta(K)$ might be disconnected by applying balancing to the cap $K \in \mathcal{K}_\Theta$ and its polygon niche $\mathcal{N}_\Theta(K)$ separately. To execute the balancing argument, we will make adjustments to the support function $h = p_K$ of cap $K$ to tweak the cap $K$ and polygon niche $\mathcal{N}_{\Theta}(K)$. The values of $h$ determine the cap ^eqn-cap-support-ftn
$$
K = P_\omega \cap \bigcap_{t \in \Theta \cup (\Theta + \pi/2)} H^-(t, h(t))
$$
and the polygon niche ^eqn-niche-support-ftn
$$
\mathcal{N}_{\Theta}(K) = F_\omega \cap
\bigcup_{t \in \Theta} \left( H_-^{\circ}(t, h(t) - 1) \cap H_-^\circ(t + \pi/2, h(t + \pi/2) - 1) \right) 
$$
completely as Nef polygons.

Assume that $K$ is not balanced. We will adjust the values of $h : \Theta \cup (\Theta + \pi/2) \to \mathbb{R}$ and make the value $|K| - |\mathcal{N}_\Theta(K)|$ larger as a function of $h$. An issue with this argument is that, as we adjust the values of $h$ to make a new function $h' : \Theta \cup (\Theta + \pi/2) \to \mathbb{R}$, there might not be a corresponding cap $K' \in \mathcal{K}_\Theta$ with the support function $p_{K'} = h'$, to conclude $\mathcal{A}_\Theta(K) < \mathcal{A}_\Theta(K')$. We circumvent this issue by choosing $h'$ carefully, so that the new intersection
$$
P_\omega \cap \bigcap_{t \in \Theta \cup (\Theta + \pi/2)} H^-(t, h'(t))
$$
is always a _translation_ of some cap in $\mathcal{K}_\Theta$. By translating the intersection back to a cap $K' \in \mathcal{K}_\Theta$, we 

# Extensions of Polygon Cap

We extend the space $\mathcal{K}_\Theta$ of polygon caps to the space $\mathcal{K}_\Theta'$ of all _translates_ of polygon caps.

> __Definition [cap-trans].__ Define the space of _polygon cap translates_ $\mathcal{K}_\Theta'$ as the collection of all translations $K'$ of arbitrary caps $K \in \mathcal{K}_\Theta$ with angle set $\Theta$. ^def-cap-trans

> __Proposition [cap-trans-space].__ A convex polygon $K'$ is in $\mathcal{K}_\Theta'$ if and only if the followings are true. ^pro-cap-trans-space
> 
> 1. The widths $p_{K'}(\omega) + p_{K'}(\omega + \pi)$ and $p_{K'}(\pi/2) + p_{K'}(3\pi/2)$ of $K'$ measured along the angles $\omega$ and $\pi/2$ are exactly one.
> 2. $K'$ is a convex polygon with normal angles in the set $\Theta \cup (\Theta + \pi/2) \cup \left\{\omega, \pi/2, \omega + \pi, 3\pi/2 \right\}$.

_Proof._ For any $K'$ satisfying conditions (1) and (2), find a translation $K$ of $K'$ such that $p_K(\omega) = p_K(\pi/2) = 1$ so that $K \in \mathcal{K}_\Theta$. On the other hand, any translate $K'$ of an arbitrary  □

Subsequently, extend $\mathcal{K}_\Theta'$ again to the space $\mathcal{H}_\Theta$ of _all_ functions $h : \widetilde{\Theta} \to \mathbb{R}$, extending the support function $h = p_{K'}$ of polygon cap translates $K'$.

> __Definition [height-space].__ For any $\omega \in (0, \pi/2]$ and nonempty finite subset $\Theta$ of $(0, \omega)$, define $\widetilde{\Theta} := \Theta \cup (\Theta + \pi/2) \cup \left\{ \omega, \pi/2 \right\}$ and define $\mathcal{H}_\Theta$ as the space of all functions $h : \widetilde{\Theta} \to \mathbb{R}$. ^def-height-space

> __Proposition [height-space-embedding].__ The map $\mathcal{K}_\Theta' \to \mathcal{H}_\Theta$ mapping $K' \in \mathcal{K}'_\Theta$ to its support function $p_{K'}$ on the domain $\widetilde{\Theta}$ is a well-defined injection. ^pro-height-space-embedding

_Proof._ By (2) of [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^pro-cap-trans-space]], the values of $p_{K'}$ on $\widetilde{\Theta}$ determine $K' \in \mathcal{K}_\Theta'$ uniquely. □

We now have a series of extensions $\mathcal{K}_\Theta \to \mathcal{K}_{\Theta'} \to \mathcal{H}_\Theta$. We will extend the functional $\mathcal{A}_\Theta$ on $\mathcal{K}_\Theta$ to $\mathcal{H}_\Theta$. The cap and niche of a cap generalizes naturally to an arbitrary function $h \in \mathcal{H}_\Theta$. We only need to follow [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^eqn-cap-support-ftn]] and [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^eqn-niche-support-ftn]].

> __Definition [height-fan-cap-niche].__ For any $h \in \mathcal{H}_\Theta$, define its _parallelogram_ ^def-height-fan-cap-niche
$$
P_h := (H
$$
> and _cap_
$$
\mathcal{C}(h) = P_h \cap \bigcap_{t \in \Theta \cup (\Theta + \pi/2)} H_-(t, h(t))
$$
> and _fan_
$$
F_h = H_+(\omega, h(\omega) - 1) \cap H_+(\pi/2, h(\pi/2) - 1)
$$
> and _niche_
$$
\mathcal{N}_{\Theta}(h) = F_h \cap \bigcup_{t \in \Theta } \left( H_-^\circ(t, h(t)) \cap H_-^\circ(t + \pi/2, h(t + \pi/2)) \right) .
$$

%% Hygiene %%

The notion of fan and niche of  [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^def-height-fan-cap-niche]] extends the notion of fan and niche of a cap $K \in \mathcal{K}_\Theta$ naturally. Under the extension $\mathcal{K}_\Theta \to \mathcal{H}_\Theta$, 

> __Proposition [height-cap].__ For any cap translate $K' \in \mathcal{K}'_\Theta$ and its support function $h = p_{K'}$, we have $\mathcal{C}(h) = K'$. ^pro-height-cap

> __Proposition [cap-fan-niche-height].__ For any cap $K \in \mathcal{K}_\Theta$ and its support function $h = p_K \in \mathcal{H}_\Theta$, we have $F_h = F_\omega$ and $\mathcal{N}_\Theta(h) = \mathcal{N}_\Theta(K)$. ^pro-cap-fan-niche-height

By [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^pro-cap-fan-niche-height]], the following [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^def-cap-translate-fan-niche]] of fan and niche of a cap translate is compatible 

> __Definition [cap-translate-fan-niche].__ Let $K' \in \mathcal{K}_\Theta'$ be any cap translate with support function $h = p_K$. Define the _fan_ $F_{K'}$ of $K'$ as $F_{K'} = F_h$ and the _niche_ of $K'$ as $\mathcal{N}_\Theta(K') = \mathcal{N}_\Theta(h)$. ^def-cap-translate-fan-niche

> __Proposition [cap-translate-fan-niche].__ Let $K' = K + v$ be a translation of a cap $K \in \mathcal{K}_\Theta$ by a vector $v \in \mathbb{R}^2$. Then we have $F_{K'} = F_\omega + v$ and $\mathcal{N}_\Theta(K') = \mathcal{N}_\Theta(K) + v$. ^pro-cap-translate-fan-niche

Using the generalizations of cap and niche, the polygon sofa area functional $\mathcal{A}_\Theta(K)$ on a cap also generalizes to $h \in \mathcal{H}_\Theta$.

> __Definition [polygon-sofa-area].__ For any $h \in \mathcal{H}_\Theta$, define its sofa area functional $\mathcal{A}_\Theta(h) = |\mathcal{C}(h)| - |\mathcal{N}_\Theta(h)|$. Correspondingly, for any extended cap $K' \in \mathcal{K}_\Theta'$ with support function $h = p_{K'}$, define $\mathcal{A}_\Theta(K')$ = $\mathcal{A}_\Theta(h)$. ^def-polygon-sofa-area

> __Proposition [polygon-sofa-area].__ For any cap $K \in \mathcal{K}_\Theta$ and $h = p_K$, we have $\mathcal{N}_\Theta(h) = \mathcal{N}_\Theta(K)$. ^pro-polygon-sofa-area

# Balancing Polygon Sofa

We first define the polygon cap $K_\Theta$ attaining the maximum value of $\mathcal{A}_\Theta$ which is bounded from the origin.

> __Theorem [maximum-area-polygon-cap].__ For any $\omega \in (0, \pi/2]$ and nonempty finite $\Theta \subset (0, \omega)$, there exists a cap $K_{\Theta} \in \mathcal{K}_\Theta$ attaining the maximum value of $\mathcal{A}_\Theta : \mathcal{K}_\Theta \to \mathbb{R}$ such that $o_\omega \in \mathcal{K}_\Theta$. ^thm-maximum-area-polygon-cap

_Proof._  □

> __Lemma [maximum-area-polygon-cap-bound].__ For any $\omega \in (0, \pi/2]$ and finite $\Theta \subset (0, \omega)$ containing $\omega/2$, the cap $K_{\Theta}$ in [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^thm-maximum-area-polygon-cap]] have  ^lem-maximum-area-polygon-cap-bound

_Proof._  □

Now we define which polygon cap $K \in \mathcal{K}_\Theta$ is _balanced_.

> __Definition [niche-region].__ For any cap $K \in \mathcal{K}_\Theta$, define the region $R_\Theta(K) := \bigcup_{t \in \Theta} Q_K^-(t)$ so that $\mathcal{N}_\Theta(K) = F_\omega \cap R_\Theta(K)$. ^def-niche-region

> __Definition [polyline].__ For any $n \geq 1$ and a finite sequence $p_1, p_2, \dots, p_n \in \mathbb{R}^2$ of points on a plane with strictly increasing $x$-coordinates, call the union of the finite segments connjecting adjacent points $p_i$ to $p_{i+1}$ ($1 \leq i < n$) an _$x$-monotone polyline_. ^def-polyline

> __Theorem [polyline].__ The boundary of the closed set $F_\omega \setminus \mathcal{N}_\Theta(K)$ is a union of the following subsets, from left to right in $\mathbb{R}^2$. ^thm-polyline
> 
> 1. The half-line starting from $C_K^+(\omega)$ and extending indefinitely in the direction $v_\omega$.
> 2. An $x$-monotone polyline $\mathbf{p}_K$ connecting $C_K^+(\omega)$ to $A_K^-(0)$ from left to right, with each segment of normal angles in $\Theta \cup (\Theta + \pi/2) \cup \left\{ \omega, \pi/2 \right\}$.
> 3. The half-line starting from $A_K^-(0)$ and extending indefinitely in the direction of $u_0$.

> __Definition [polyline].__ Define the polyline $\mathbf{p}_K$ in [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^thm-polyline]] as the _polyline of cap_ $K \in \mathcal{K}_\Theta$. ^def-polyline

> __Definition [polyline-length].__ For any cap $K \in \mathcal{K}_\Theta$ and angle $t \in \Theta \cup (\Theta + \pi/2)$, define $\nu_K(t)$ as the sum of the lengths of the edges in the polyline $\mathbf{p}_K$ with normal angle $t$. ^def-polyline-length

> __Definition [polygon-cap-balanced].__ Say that a polygonal cap $K \in \mathcal{K}_\Theta$ is _balanced_ if and only if for any $t \in \widetilde{\Theta}$, we have $\sigma_K(t) = \nu_K(t)$. ^def-polygon-cap-balanced

> __Proposition [polyline-length].__ ^pro-polyline-length
> 
> 1. For any $t \in \Theta \setminus \left\{ \omega \right\}$, we have $\nu_K(t) = \lambda^1 \left( \partial \mathcal{N}(K) \cap b_K(t) \right)$.
> 2. For any $t \in \Theta \setminus \left\{ 0 \right\}$, we have $\nu_K(t + \pi/2) = \lambda^1 \left( \partial \mathcal{N}(K) \cap d_K(t) \right)$.
> 3. $\nu_K(\omega) + \lambda^1\left( \overline{\mathcal{N}(K)} \cap l(\omega, 0) \right) = \sigma_K(\omega + \pi)$.
> 4. $\nu_K(\pi/2) + \lambda^1$

Each $\nu_K(t)$ measures the contribution of each line to the boundary of $\mathcal{N}_\Theta(K)$.

> __Lemma [balancing].__ Let $K \in \mathcal{K}_\Theta$ be a polygonal cap with support function $h = p_K \in \mathcal{H}_\Theta$. There exists a constant $\epsilon = \epsilon(K) > 0$ such that the following holds. Let $t \in \Theta \cup (\Theta + \pi/2)$ and $\delta \in [0, \epsilon]$ be arbitrary. Define $h' \in \mathcal{H}_\Theta$ as $h'(t) = h(t) + \delta$ and $h'(u) = h(u)$ for all $u \in \Theta \cup (\Theta + \pi/2)$ with $u \neq t$. Then $\mathcal{A}_\Theta(h') = \mathcal{A}_\Theta(K) + (\sigma_K(t) - \nu_K(t)) \delta + O(\delta^2)$. ^lem-balancing



> __Lemma [cap-positive-direction].__ Let $K \in \mathcal{K}_\Theta$ be a polygonal cap which is _not_ balanced. Then at least one of the following statements should be true. ^lem-cap-positive-direction
> 
> 1. There is an angle $t \in \Theta \cup (\Theta + \pi/2)$ with $t \neq \omega, \pi/2$ such that $\nu_K(t) < \sigma_K(t)$.
> 2. $\omega = \pi/2$ and $\nu_K(\pi/2) < \sigma_K(\pi/2)$.
> 3. $\omega < \pi/2$, and $\nu_K(\omega) < \sigma_K(\omega)$ and $0 < \sigma_K(3\pi/2)$.
> 4. $\omega < \pi/2$, and $\nu_K(\pi/2) < \sigma_K(\pi/2)$ and $0 < \sigma_K(\omega + \pi)$.

> __Lemma [height-to-cap].__ Assume an arbitrary $h \in \mathcal{H}_\Theta$ such that $K' := \mathcal{C}(h)$ is a cap translate, so that $K' \in \mathcal{K}_\Theta'$. Then $\mathcal{A}_\Theta(h) \leq \mathcal{A}_\Theta(K')$. ^lem-height-to-cap

_Proof._ By the [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^def-height-fan-cap-niche]] of $K' = \mathcal{C}(h)$, we have $p_{K'}(t) \leq h(t)$ for all $t \in \Theta \cup (\Theta + \pi/2) \cup \left\{ \omega + \pi, 3\pi/2 \right\}$ and 

Also need $F_{K'} = F_h$. This reduces to $p_{K'}(t + \pi) = h(t + \pi)$ for $t = \omega, \pi/2$. The chain of inequalities $1 = p_K(t) + p_K(t + \pi) \leq h(t) + (1 - h(t)) = 1$ shows that the inequality should hold. □

> __Theorem [balanced-polygon-sofa].__ Let $K \in \mathcal{K}_\Theta$ be any maximizer of the polygon sofa area $\mathcal{A}_\Theta(K)$ on the polygon cap space $\mathcal{K}_\Theta$. Then $K$ is balanced ([[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^def-polygon-cap-balanced]]). In particular, the following inequalities are true for such $K$. ^thm-balanced-polygon-sofa
> 
> - If $\omega < \pi/2$, then $\sigma_K(\pi/2) \geq w_K^{\Theta}$ and $\sigma_K(\omega) \geq z_K^{\Theta}$.
> - If $\omega = \pi/2$, then $\sigma_K(\pi/2) \geq w_K^{\Theta} + z_K^{\Theta}$.

_Proof._ (of [[a. Angle Hypothesis/10. Balanced Sofa/15. Balanced Polygon Sofa#^thm-balanced-polygon-sofa]]) □

> __Definition [wedge-gap-polygon].__ Let $K \in \mathcal{K}_\Theta$ be an arbitrary polygon cap. Define its _right wedge gap_ $w_K^\Theta := \min(\sigma(-\pi/2), \min_{t \in \Theta} w_K(t))$ and _left wedge gap_ $z_K^\Theta := \min(\sigma(-\omega), \min_{t \in \Theta } z_K(t))$. ^def-wedge-gap-polygon

