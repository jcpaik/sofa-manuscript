The procedure $\mathsf{sbranch}(\Theta)$ takes the finite angle set $\Theta$ and returns the subset of $\mathcal{K}_\Theta$ with $\mathcal{A}_\Theta (K) \geq \mu_G$ in a tree form $T_\Theta$.

In this section, fix a finite angle set $\Theta$ with angles $0 = \theta_0 < \dots < \theta_n = \pi/2$ and rotation angle $\pi/2$. Let $K$ be an arbitrary member of $\mathcal{K}_\Theta$. Denote the parts of the polygon $K$.

> __Definition [sofa-polygon-notations].__ Let the index $0 \leq i \leq n$ be arbitrary. Define the following notions for the arbitrary chosen $K \in \mathcal{K}_\Theta$. ^def-sofa-polygon-notations
> 
> - $p_i = p_K(\theta_i)$, $\mathbf{x}_i = \mathbf{x}_K(\theta_i)$, $\mathbf{y}_i = \mathbf{y}_K(\theta_i)$
> - Lines $a_i = a_K(\theta_i)$, $b_i = b_K(\theta_i)$, $c_i = c_K(\theta_i)$, $d_i = d_K(\theta_i)$.
> - With a bit of abuse of notation, we will also define $d_i = c_{n + i}$ for any negative index $-n \leq i < 0$ as well.

In this way, the niche of $S$ is bounded by a polyline forming. Also, the slope of $d_i$ increases by the index $i$, and is positive when $i > 0$ and negative when $i < 0$. Define the normal vectors $v_i$ of $d_i$ including the negative vectors.

The set $\mathcal{K}_\Theta$ is a polytope.

> __Definition [sofa-inequality].__ Define a _sofa inequality_ $I$ as a linear inequality on $\mathcal{K}_\Theta$ with equality condition.
> ^def-sofa-inequality

> __Definition [sofa-polytope].__ A _sofa polytope_ $N$ is a finite set of linear inequalities $\left\{ I_1, \dots, I_m \right\}$ on $\mathcal{K}_\Theta$. Say that $K \in N$ if the inequality $I_i$ holds for $K$ for all $1 \leq i \leq m$.
> ^def-sofa-polytope

So a sofa polytope $N$ denotes a subset of $\mathcal{K}_\Theta$ which is a polytope.

Let's make no distintion between a polytope $P$ and its list of inequalities.

> __Definition [branch-tree].__ A _branch tree_ $T$ of $\mathcal{K}_\Theta$ is a complete binary tree consisting of the followings. ^def-branch-tree
> 
> - Each node is a sofa polytope. 
> - The root node $N_0$ is the empty set $\left\{  \right\}$, and denotes the whole space $\mathcal{K}_\Theta$.
> - Any non-leaf node of $T$ is split into two childs $N \cup \left\{ I \right\}$ and $N \cup \left\{ I^c \right\}$ by a sofa inequality $I$.

> __Definition [polyline].__ A _polyline_ $\mathbf{i}$ is a finite sequence $\mathbf{i} = i_0, \dots, i_m$ of indices with integers $-n < i_j < n$ such that the followings hold. ^def-polyline
> 
> 1. $i_0 = i_m = 0$.
> 2. For any adjacent $i_{j - 1}$, $i_{j}$ with $j > 0$, we have $i_{j - 1} \neq i_j$.
> 3. If $i_{j - 1} > i_{j}$ for $j > 0$, then  $i_j = i_{j-1} - n$.
> 4. For any $1 \leq i < n$, if the numbers $i$ and $i - n$ both appear in $\mathbf{i}$, then all occurences of $i$ in $\mathbf{i}$ is on the left side of all the occurences of $i - n$ in $\mathbf{i}$.

The polyline $\mathbf{i}$ represents the subset of niche $\mathcal{N}(K)$ bounded from below by the line $y=0$ and bounded from above by the sequence of lines $l_{i_0}, l_{i_1}, \dots, l_{i_m}$ with the vertices $v(i_{j - 1}, i_{j})$ appearing from left to right. Condition 1 implies that the initial and final lines are equal to $l_0$, which is the line $y=0$. Condition 2 implies that the vertices $v(i_{j-1}. i_j)$ are well-defined for any $1 \leq j \leq m$. Condition 3 implies that any 'concave' turn from $l_{j - 1}$ to $l_j$ happens at the corner $v(i_{j-1}, i_j) = \mathbf{x}_{i_{j-1}}$ of hallway $L_{i_{j-1}}$. Condition 4 implies that

> __Definition [sofa-node].__ A sofa node is the tuple $(N, \mathbf{p})$ of a sofa polytope $N$ and a polyline $\mathbf{p}$, so that a list of properties hold.
> ^def-sofa-node



(TODO: change the following into a theorem format)

> __Definition [sofa-branch-tree].__ A branch tree $T$ is a _sofa branch tree_ with angle set $\Theta$ if the followings hold. ^def-sofa-branch-tree
> 
> - The root node $T$ represents the convex polytope $\mathcal{K}_\Theta$.
> - Every leaf node of $T$ is either _invalid_ or _valid_.
> - A invalid node $P$ is equipped with an admitted polyline $\mathbf{i}$, so that the maximum value of $\mathcal{A}_\mathbf{i}$ constrainted to $P$ is at most $2.2195\dots$.
> - A valid node $P$ is also equipped with an admitted polyline $\mathbf{i}$, and represents a subset $P \cap \left\{ \mathcal{A}_{\mathbf{i}} \geq 2.2195 \right\}$.




```pseudo
\begin{algorithm}
\caption{AddCorner}
  \begin{algorithmic}
  \Procedure{AddCorner}{$\mathbf{p}, i$}
	\If{$\mathbf{x}_i$ is below $l_0$}
	  \Return{$\mathbf{p}$}
	\EndIf 
	\State $i_0, i_1, \dots, i_m \gets \mathbf{p}$
	\For{$j \gets 0$ \To $m$}
	  \If{$j < m$ \And $\mathbf{x}_i$ is on left side of $v(i_j, i_{j+1})$}
	    \If{$j \neq 0, m$ \And $\mathbf{x}_i$ is below $l_{i_j}$}
	      \Return{\Call{AddCornerInside}{$\mathbf{p}, i, j$}}
	    \Else
	      \Return{\Call{AddCornerOutside}{$\mathbf{p}, i, j$}}
	    \EndIf
	  \EndIf
	\EndFor
  \EndProcedure
  \Procedure{AddCornerInside}{$\mathbf{p}, i, j$}
	\State $x \gets A[r]$
	\State $i \gets p - 1$
	\For{$j \gets p$ \To $r - 1$}
	  \If{$A[j] < x$}
		\State $i \gets i + 1$
		\State exchange
		$A[i]$ with $A[j]$
	  \EndIf
	\State exchange $A[i]$ with $A[r]$
	\EndFor
  \EndProcedure
  \end{algorithmic}
\end{algorithm}
```


- The procedure generates a claim of tree that we can always verify by verifier.
- The procedure is guaranteed to produce a correct tree, with theoretical proof.