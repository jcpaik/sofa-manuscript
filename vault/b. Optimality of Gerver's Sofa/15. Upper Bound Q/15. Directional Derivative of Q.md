We now calculate the directional derivative of $\mathcal{Q}$. We prepare calculations for the convex curves $\mathbf{b}$ and $\mathbf{d}$, and the inner corner $\mathbf{x}_K$.

> __Theorem [derivative-area-convex-curve].__ Let $I = [t_0, t_1]$ be any closed interval in $S^1$. The directional derivative of $\mathcal{I}$ on $\mathcal{E}_{I}$ at $\mathbf{e} \in \mathcal{E}_{I}$ in the direction towards $\mathbf{e}^* \in \mathcal{E}_I$ is ^thm-derivative-area-convex-curve
$$
\mathcal{D}\mathcal{I}(\mathbf{e}; \mathbf{e}^*) = \int_{t \in I} (p_\mathbf{e^*}(t) - p_\mathbf{e}(t)) \, \sigma_{\mathbf{e}} (dt) + \mathcal{I}(v_\mathbf{e}^-(t_0), ).
$$

_Proof._  □

In particular, the degenerate case $t_0 = t_1 = t$ at [[b. Optimality of Gerver's Sofa/15. Upper Bound Q/15. Directional Derivative of Q#^thm-derivative-area-convex-curve]] above gives the directional derivative of line segments.

Assemble three above to $\mathbf{z}$.


First we calculate the derivative of the area $|K|$ with respect to $K$.

> __Theorem [convex-body-area-variation].__ Let $K$ and $K'$ be arbitrary convex bodies. Then we have ^thm-convex-body-area-variation
$$
\left. \frac{d}{d \lambda} \right|_{\lambda=0} \left| (1-\lambda) K + \lambda K' \right|  = \left< p_{K'} - p_K , \beta_K \right>_{S^1}.
$$

_Proof._ For any convex body $K$ we have $|K| = V(K, K)$ where $V$ is the mixed volume of two planar convex bodies. So by applying [[xb. Upper Bound A1/25. Upper Bound A1/02. Calculus of variation#^lem-derivative-calculation]] to $|K| = V(K, K)$ and using that $V(K, K') = V(K', K)$, we have the following.
$$
\left. \frac{d}{d \lambda} \right|_{\lambda=0} \left| (1-\lambda) K + \lambda K' \right| = 2V(K', K) - 2V(K, K)  
$$
By applying [[b. Optimality of Gerver's Sofa/05. Convex bodies/10. Surface area measure#^thm-surface-area-measure-area]] we get the result. □

We now calculate the derivative of $\mathcal{I}(\mathbf{x}_K)$ with respect to $K$. We have the following general calculation for the curve area functional $\mathcal{I}(\mathbf{x})$.

> __Theorem [variation-curve].__ Let $\mathbf{x}_1, \mathbf{x}_2 : [a, b]\to\mathbb{R}^2$ be two rectifiable curves. Then the following holds. ^thm-variation-curve
$$
\left. \frac{d}{d \lambda} \right|_{\lambda = 0} \mathcal{I}((1 - \lambda)\mathbf{x}_1 + \lambda \mathbf{x}_2) = \left[ \int_a^b (\mathbf{x}_2(t) - \mathbf{x}_1(t))  \times d\mathbf{x}_1 (t) \right] +  \mathcal{I}(\mathbf{x}_1(b), \mathbf{x}_2(b)) - \mathcal{I}(\mathbf{x}_1(a), \mathbf{x}_1(a))
$$

_Proof._ Consider the bilinear form $\mathcal{J}(\mathbf{x}_1, \mathbf{x}_2) = \int_a ^b \mathbf{x}_1(t) \times d \mathbf{x}_2(t)$ on rectifiable $\mathbf{x}_1, \mathbf{x}_2 : [a, b] \to \mathbb{R}^2$. Apply [[xb. Upper Bound A1/25. Upper Bound A1/02. Calculus of variation#^lem-derivative-calculation]] to $2\mathcal{I}(\mathbf{x}) = \mathcal{J}(\mathbf{x}, \mathbf{x})$ to get ^eqn-variation-curve
$$
\left. \frac{d}{d \lambda} \right|_{\lambda = 0} 2\mathcal{I}((1 - \lambda)\mathbf{x}_1 + \lambda \mathbf{x}_2) = \mathcal{J}(\mathbf{x}_1, \mathbf{x}_2) + \mathcal{J}(\mathbf{x}_2, \mathbf{x}_1) - 2 \mathcal{J}(\mathbf{x}_1, \mathbf{x}_1).
$$
Using the integration by parts ([[b. Optimality of Gerver's Sofa/05. Convex bodies/07. Lebesgue-Stieltjes measure#^pro-lebesgue-stieltjes-product]]), we have
$$
\int_a^b \mathbf{x}_1(t) \times d \mathbf{x}_2(t) = \mathbf{x}_1 (b) \times \mathbf{x}_2(b) - \mathbf{x}_1(a) \times \mathbf{x}_2(a) + \int_a^b \mathbf{x}_2(t) \times d\mathbf{x}_1 (t)
$$
or
$$
\mathcal{J}(\mathbf{x}_1, \mathbf{x}_2) = 2\mathcal{I}(\mathbf{x}_1(b), \mathbf{x}_2(b)) - 2\mathcal{I}(\mathbf{x}_1(a) - \mathbf{x}_2(a)) + \mathcal{J}(\mathbf{x}_2, \mathbf{x}_1).
$$
Plug this back in [[xb. Upper Bound A1/25. Upper Bound A1/15. Directional derivative of A1#^eqn-variation-curve]] and rearrange to get the claimed equality in [[xb. Upper Bound A1/25. Upper Bound A1/15. Directional derivative of A1#^thm-variation-curve]]. □

We introduce a measure $\iota_K$ to calculate the derivative of $\mathcal{I}(\mathbf{x}_K)$ with respect to cap $K$.

> __Definition [i-cap].__ For any cap $K \in \mathcal{K}_{\omega}$, define the function $i_K : J_\omega \to \mathbb{R}$ as $i_K(t) = h_K^+(t) - 1$ and $i_K(t + \pi / 2) = g^+_K(t) - 1$ for every $t \in [0, \omega]$. Define $\iota_K$ as the measure on $J_\omega$ derived from the density function $i_K$. That is, $\iota_K(dt) = i_K(t) dt$. ^def-i-cap

[[xb. Upper Bound A1/25. Upper Bound A1/15. Directional derivative of A1#^def-i-cap]] is motivated by the following lemma.

> __Lemma [i-cap].__ Let $I \subseteq [0, \omega]$ be an arbitrary Borel subset. Let $K_1, K_2 \in \mathcal{K}_{\omega}$ be arbitrary. Then the following holds. ^lem-i-cap
$$
\int_{t \in I} \mathbf{x}_{K_1}(t) \times d \mathbf{x}_{K_2} (t) = \left< p_{K_1} - 1, \iota_{K_2} \right>_{I \cup (I + \pi/2)} 
$$

_Proof._ By [[xb. Upper Bound A1/25. Upper Bound A1/01. Definition of A1#^thm-inner-corner-deriv]] and [[xb. Upper Bound A1/25. Upper Bound A1/01. Definition of A1#^pro-arm-length-unsigned]], the derivative of $\mathbf{x}_{K_2}(t)$ with respect to $t$ exists almost everywhere and is the following.
$$
\mathbf{x}'_{K_2}(t) = -(g_{K_2}^+(t) - 1) u_t + (h_{K_2}^+(t) - 1) v_t
$$
Meanwhile, we have the following.
$$
\mathbf{x}_{K_1}(t) = (p_{K_1} (t) - 1) u_t + 
(p_{K_1} (t + \pi / 2) - 1) v_t
$$
So the cross-product $\mathbf{x}_{K_1}(t) \times \mathbf{x}_{K_2}'(t)$ is equal to the following almost everywhere.
$$
(h_{K_2}^+(t) - 1) (p_{K_1} (t) - 1) + (g_{K_2}^+(t) - 1) (p_{K_1} (t + \pi / 2) - 1)
$$
Now the left-hand side is equal to
$$
\int_{t \in J} (h_{K_2}^+(t) - 1) (p_{K_1} (t) - 1) + (g_{K_2}^+(t) - 1) (p_{K_1} (t + \pi / 2) - 1) \, dt
$$
and by [[xb. Upper Bound A1/25. Upper Bound A1/15. Directional derivative of A1#^def-i-cap]] this integral is equal to $\left< p_{K_1} - 1, \iota_{K_2} \right>_{I \cup (I + \pi/2)}$. □

> __Theorem [variation-a1].__ Let $K_1$ and $K_2$ be two caps in $\mathcal{K}_{\omega}$. Then we have the following. ^thm-variation-a1
$$
D\mathcal{A}_1(K_1; K_2) = \left. \frac{d}{d\lambda} \right|_{\lambda = 0} \mathcal{A}_1((1 - \lambda) K_1 + \lambda K_2)
= \left< p_{K_2} - p_{K_1}, \beta_{K_1} - \iota_{K_1} \right>_{J_\omega}
$$

_Proof._ We have $\mathcal{A}_1(K) = |K| - \mathcal{I}(\mathbf{x}_K)$. Apply [[xb. Upper Bound A1/25. Upper Bound A1/15. Directional derivative of A1#^thm-convex-body-area-variation]] to the term $|K|$ to have the following.
$$
\left. \frac{d}{d \lambda} \right|_{\lambda=0} \left| (1-\lambda) K_1 + \lambda K_2 \right|  = \left< p_{K_2} - p_{K_1} , \beta_{K_1} \right>_{S^1}
$$
Note that $\beta_{K_1}$ and $\beta_{K_2}$ are supported on the set $J_\omega \cup \left\{ \pi + \omega, 3\pi/2 \right\}$, and both $p_{K_2}$ and $p_{K_1}$ have function value equal to 1 on the set $\left\{ \pi + \omega, 3\pi/2 \right\}$. So we have $\left< p_{K_2} - p_{K_1} , \beta_{K_1} \right>_{S^1} = \left< p_{K_2} - p_{K_1} , \beta_{K_1} \right>_{J_\omega}$.

Apply [[xb. Upper Bound A1/25. Upper Bound A1/15. Directional derivative of A1#^thm-variation-curve]] to the term $\mathcal{I}(\mathbf{x}_K)$, and use that the points $O$, $\mathbf{x}_{K}(0)$, and $A^-_K(0)$ (respectively, the points $O$, $\mathbf{x}_K(\omega)$, and $C_K^+(\omega)$) are colinear to get the following.
$$
\begin{align*}
\left. \frac{d}{d \lambda} \right|_{\lambda = 0} \mathcal{I}((1 - \lambda)\mathbf{x}_{K_1} + \lambda \mathbf{x}_{K_2}) & = \int_0^{\omega} (\mathbf{x}_{K_2}(t) - \mathbf{x}_{K_1}(t)) \times d\mathbf{x}_{K_1}(t) \\
& = \left< p_{K_2} - p_{K_1}, \iota_{K_1} \right> 
\end{align*}
$$
The second equality comes from applying [[xb. Upper Bound A1/25. Upper Bound A1/15. Directional derivative of A1#^lem-i-cap]] twice. Subtract the derivates of $|K|$ and $\mathcal{I}(\mathbf{x}_K)$ above to conclude the proof. □
