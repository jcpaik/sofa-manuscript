> __Definition [cap-space-special].__ Define $\mathcal{K}^\mathrm{i}$ as the subspace of $K \in \mathcal{K}$ such that the followings holds. ^def-cap-space-special
> 
> 1. For any $t \in [0, \pi/2)$ we have $\sigma_K(t) = 0$. That is, the supporting line $a_K(t)$ makes contact with $K$ at a single point.
> 2. (Analogous for above with $C$.)
> 3. For any $t \in [0, \pi/2]$, the derivative $\mathbf{x}_K'$ exists, is continuous on the compact domain, and satisfies $\mathbf{x}_K'(t) \cdot \mu(t) < 0$ and $\mathbf{x}_K'(t) \cdot \nu(t) > 0$.
> 4. We have $|K| > 2.2$.

> __Theorem [cap-space-special].__ The space $\mathcal{K}^\mathrm{i}$ is a convex subspace of $\mathcal{K}$. ^thm-cap-space-special

We will construct a upper bound $\mathcal{Q}$ of $\mathcal{A}$ on $\mathcal{K}^\mathbf{i}$.

Upper bound strategy:

- IF $|K| > 2.2$, then $\mathcal{A} \leq \mathcal{Q}$.
- THERE IS some $K \in \mathcal{K}^\mathrm{i}$ such that $\mathcal{A}(K)$ attains the maximum value on $\mathcal{K}$.
- $\mathcal{Q}$ on the space $\mathcal{K}^\mathrm{i}$ achieves maximum at Gerver's sofa, and for Gerver's sofa, 
- Well, by Brunn-Minkowski theorem $|(1 - \lambda)A + \lambda B| \geq |A|^{1 - \lambda} |B|^{\lambda}$, the condition $|K| \geq 2.2$ is also convex. Would be fine just defining it that way...

We use the letters $\mathrm{L}$ and $\mathrm{R}$ in superscript to denote the left and right part of the cap respectively.

> __Definition [varphi-constants].__ Fix absolute constants $\varphi^{\mathrm{R}} = \varphi$ and $\varphi^{\text{L}} = \pi/2 - \varphi$, where the constant $\varphi$ comes from the derivation of Gerver's sofa (). ^def-varphi-constants

> __Remark [varphi-constants].__ Note that $\varphi^{\text{R}} \in (0, \pi/4)$ and $\varphi^{\text{L}} \in (\pi/4, \pi/2)$ in particular. Almost all theorems in this paper will work for arbitrary choice of constants $\varphi^{\textrm{R}} \in (0, \pi/4)$ and $\varphi^{\textrm{L}}\in (\pi/4, \pi/2)$. The only exceptions are XX and YY; see Rem XX and YY respectively. ^rem-varphi-constants

For Gerver's sofa $S^{\mathrm{G}}$ with cap $K^{\mathrm{G}}$, the inner corner $\mathbf{x}_{K^\mathrm{G}}(t)$ draws a main 'core' part of the niche $\mathcal{N}_{K^{\mathrm{G}}}$ at the interval $t \in [\varphi^\mathrm{R}, \varphi^\mathrm{L}]$. The goal now is to find an upper bound $\mathcal{Q}$ of the sofa area $|K| - \left| \mathcal{N}_{K} \right|$ for a general cap $K \in \mathcal{K}$. We will break the cap $K$ and niche $\mathcal{N}_K$ into three parts.

> __Definition [cap-left-right].__ For any $K \in \mathcal{K}$, define the line $l_K^\textrm{R} := \overline{b}_K(\varphi^\textrm{R})$ and the half-plane $H_K^\textrm{L} := H_K^\mathrm{b}(\varphi^\textrm{R})$ bounded by the line $l_K^\textrm{R}$ with normal angle $\varphi^\textrm{R} + \pi$. Similarly, define the line $l_K^\textrm{L} := \overline{d}_K(\varphi^\textrm{L})$ and the half-plane $H_K^\textrm{R} := H_K^\textrm{d}(\varphi^\textrm{L})$ bounded by the line $l_K^\textrm{L}$ with normal angle $\varphi^\textrm{L} + \pi$. ^def-cap-left-right

> __Definition [cap-left-right-partition].__ For any $K \in \mathcal{K}$, define the convex regions $B_K := K \cap H_K^\textrm{R}$, $D_K := K \cap H_K^\textrm{L}$ and $M_K := K \setminus H_K^\textrm{R} \setminus H_K^\textrm{L}$. ^def-cap-left-right-partition

> __Lemma [cap-left-right-disjoint].__ Let $K \in \mathcal{K}$ be of area $|K| > 2.2$. The the sets $D_K$ and $B_K$ are disjoint. Correspondingly, such a $K$ is a disjoint union of three parts $B_K, M_K, D_K$ from right to left, separated by the lines $l_K^\textrm{R}$ and $l_K^\textrm{L}$. ^lem-cap-left-right-disjoint

As $\mathcal{N}_K$ is a subset of $K$, the niche $\mathcal{N}_K$ is also paritioned into three parts $\mathcal{N}_K \cap B_K$, $\mathcal{N}_K \cap D_K$ and $\mathcal{N}_K \cap M_K$. We bound the area of each part from below separately. The right and left part $\mathcal{N}_K \cap B_K$ and $\mathcal{N}_K \cap D_K$ are traced out by the convex curves $\mathbf{b}_K$ and $\mathbf{d}_K$ defined as below.

> __Definition [left-right-regions].__ For any $K \in \mathcal{K}$,  Define the convex body $B_K^0 := K \cap \bigcap_{t \in [\varphi_R, \pi/2]} H_K^b(t)$ so that $B_K^0 \subseteq B_K$. Define the convex curve ^def-left-right-regions
$$
\mathbf{b}_K := \mathbf{u}_{B_K^0}^{\varphi^\textrm{R} + \pi, 3\pi/2}.
$$
> Similarly, define the convex body $D_K^0 := K \cap \bigcap_{t \in [0, \varphi_L]} H_K^d(t)$ so that $D_K^0 \subseteq D_K$. Define the convex curve
$$
\mathbf{d}_K := \mathbf{u}_{D_K^0}^{\pi, \varphi^\textrm{L} + \pi}.
$$

We want to show basically that the hyperplanes $H_K^\mathrm{b}$ cut out only the lower left corner of $B_K$ to form $\mathbf{b}_K$.

> __Lemma [monotonicity-intervals].__ Fix an arbitrary $K \in \mathcal{K}^\mathrm{i}$. For any $t \in (\varphi^\mathrm{R}, \pi/2]$, the point $\mathbf{x}_K(t)$ is outside the hyperplane $H_K^\mathrm{b}(\varphi^\mathrm{R})$. So  ^lem-monotonicity-intervals

We first approximate the left and right part of the niche by two tails.

> __Lemma [cap-left-right-tail].__ Fix an arbitrary $K \in \mathcal{K}^\mathrm{i}$ and omit the subscript in $\mathbf{b}_K$, $N_K$ and $B_K$. We have $\mathcal{M}_{\mathbf{b}_K} \subseteq B_K \cap \mathcal{N}_K$. ^lem-cap-left-right-tail

proof::

> __Lemma [corner-always-outside].__ Fix an arbitrary $K \in \mathcal{K}^\mathrm{i}$. Omit the subscript and denote $B_K$ as $B$. The followings are true in succession. ^lem-corner-always-outside
> 
> 1. The supporting line $l_B(\varphi^\mathrm{R} + \pi)$ is the line $l_K^\mathrm{R}$ and the corresponding edge $e_B(\varphi^\mathrm{R} + \pi)$ connects two points $W_K(\varphi^\mathrm{R})$ and $l_K^\mathrm{R} \cap \delta K$. (proof: shoot ray upwards
> 2. The edge $e_B(3\pi/2)$ of $B$ connects two points $W_K(\varphi^\mathrm{R})$ and $A_K^-(0)$. Correspondingly, for any $t \in (\varphi^\mathrm{R} + \pi, 3\pi/2)$, the hyperplane may or may not $W_K(\varphi^\mathrm{R})$ and excludes $l_K^\mathrm{R} \cap \delta K$ and $A_K^-(0)$.
> 3. So $H_K^\mathrm{b}(t) \cap B_K = H_K^\mathrm{b}(t) \cap H_K^\mathrm{b}(\varphi_R) \cap H_K(3\pi/2)$.

_Proof._ Main observation is that, the half-line $b_K(t)$ intersected with that half-plane $H_K^b(\varphi_R)$ is not different from the full line $\overline{b}_K(t)$. Another words, $Q_K^-(t) \cap H_K^b(\varphi_R) = H_K^b(\varphi_R) \setminus H_K^b($

The point $\mathbf{x}_K(\varphi_R)$ is strictly inside $K \setminus \delta K$. So $\overline{b}_K(\varphi_R)$ intersects at the upper boundary $\delta K$ for some point $p$. □

Question: can we forget the technical listings 1-3 above???

Then we approximate the middle part of the niche by the core traced out by $\mathbf{x}_K$ restricted to the interval $[\varphi^\mathrm{R}, \varphi^\mathrm{L}]$.

> __Lemma [cap-middle-lower-estimate].__ Fix an arbitrary $K \in \mathcal{K}^\mathrm{i}$. We have $|M_K| \geq \mathcal{I}(\mathbf{x}_K|_{[\varphi^\mathrm{R}, \varphi^\mathrm{L}]}) + \mathcal{I}(\mathbf{x}_K(\varphi^\mathrm{L}), Z_K(\varphi^\mathrm{L})) + \mathcal{I}(\mathbf{x}_K(\varphi^\mathrm{R}), W_K(\varphi^\mathrm{R}))$. ^lem-cap-middle-lower-estimate

The curve $\mathbf{x}_K : [\varphi_R, \varphi_L] \to \mathbb{R}^2$ is inside $K_M$ except endpoints because of monotonicity. Take the cone $Y$ bounded by the lines $b$ and $d$. Take the horizontal line $l_h$ described by the equation $y = -h$ for sufficiently large $h > 0$. Take the closed curve. First follow $\mathbf{x} := \mathbf{x}_K|_{[\varphi_R, \varphi_L]}$. Follow the line segment $s_L$ from $\mathbf{x}_K(\varphi_L)$ to $d \cap l_h$. Follow the line segment $s_M$ from $d \cap l_h$ to $b \cap l_h$. Follow the line segment $s_L$ from $b \cap l_h$ to $\mathbf{x}_K(\varphi_L)$. The Jordan arcs $\mathbf{x}$ and $s_L$ and $s_R$ only meet at corresponding endpoints because $\mathbf{x}$ is inside $K_M$ except endpoints, and $s_L \subset d$ and $s_R \subset d$. The $s_M$ only meet with $s_L$ and $S_R$ at corresponding endpoints too for the same reason. Finally, by taking $h$ sufficiently large we can push $s_M$ as down as possible so that $s_M$ is disjoint from $\mathbf{x}$. WIth this, the closed loop $\Gamma$ formed by $\mathbf{x}$, $s_L, s_M, s_R$ forms a Jordan curve, enclosing a region $G$.

Line segments $s_L$, $s_R$, $s_W$, $s_Z$. 

Area $\mathcal{I}(\Gamma) = \mathcal{I}(\mathbf{x}) + \mathcal{I}(s_L) + \mathcal{I}(s_M) + \mathcal{I}(s_R)$. Trapezoid $P$ formed by the vertices $z_K(\varphi_R), d \cap l_h, b \cap l_h, w_K(\varphi_R)$. 

$G \subseteq \left( \mathcal{N}_K \cap K_M \right) \cup P$. Why? Since $\Gamma$ is inside the triangular region $T$ bounded by $b$, $d$, and $l_h$, so is $G \subseteq T$. So it suffices to check $G \setminus T \subseteq G \cap \text{region above } y=0$ is contained inside. For any $p \in G$, shoot a ray $r_p$ above. It never hits $s_M$. If it hits $s_L$, then as $s_L \cap H_0$ is the line connecting $s_R$  

Then $\mathbf{z}_K^{\varphi_R, \varphi_L}$ is a curve below the niche $\mathcal{N}_K$. Define $\mathcal{A}_2^{\varphi_R, \varphi_L}$ as $|K| - \mathcal{I}(\mathbf{z}_K^{\varphi_R, \varphi_L})$.

Correspondingly, define $\mathcal{Q}^{\varphi_R, \varphi_L} : \mathcal{K}^{\varphi_R, \varphi_L}$ as

We embed $\mathcal{K}_{\pi/2}$ in a larger convex space $\mathcal{L}$ and extend $\mathcal{A}_2$ on $\mathcal{K}_{\pi/2}$ to functional $\mathcal{Q}$ on $\mathcal{L}$. Unlike $\mathcal{A}_2$ on $\mathcal{K}_{\pi/2}$, $\mathcal{Q}$ on $\mathcal{L}$ turns out to be quadratic and concave.

> __Definition [cap-tail-space].__ Define the _cap-tail space_ $\mathcal{L}$ as the space of tuples $(K, \mathbf{b}, \mathbf{d})$ of a cap $K \in \mathcal{K}$, curve $\mathbf{b} \in \mathcal{U}^{\pi + \varphi_R, 3\pi/2}$, and curve $\mathbf{d} \in \mathcal{U}^{\pi, \pi + \varphi_L}$ such that the followings are true. ^def-cap-tail-space
> 
> 1. $\sigma_K\left( \left\{ t \right\} \right) = 0$ for all $t \in [0, \pi] \setminus \left\{ \pi/2 \right\}$.
> 2. For every $t \in [\varphi_R, \pi/2]$, we have $h_K(t) + h_{\mathbf{b}}(\pi + t) \leq 1$.
> 3. We have $h_{\mathbf{b}}(\pi + \varphi_R) = 1 - h_K(\varphi_R)$ and $h_\mathbf{b}(3\pi/2) = 0$. That is, the equality in (2) holds for endpoints $t = \varphi_R, \pi/2$.
> 4. For every $t \in [0, \varphi_L]$, we have $p_K(t + \pi/2) + p_{\mathbf{d}}(\pi + t) \leq 1$.
> 5. We have $h_{\mathbf{b}}(\pi + \varphi_R) = 1 - h_K(\varphi_R)$ and $h_\mathbf{b}(3\pi/2) = 0$. That is, the equality in (2) holds for endpoints $t = \varphi_R, \pi/2$.

> __Proposition [extended-cap-space].__ The space $\mathcal{L}^{\varphi_R, \varphi_L}$ is a convex space containing any limiting maximum sofa and Gerver's sofa. ^pro-extended-cap-space

_Proof._ The product $\mathcal{T}$ of convex spaces $\mathcal{K}$, $\mathcal{U}^{\pi + \varphi_R, 3\pi/2}$, and $\mathcal{U}^{\pi, \pi + \varphi_L}$ is naturally a convex space. All conditions in [[c. Optimality of Gerver's Sofa/15. Upper Bound Q/05. Definition of Q#^def-cap-tail-space]] are linear equalities and inequalities on $(K, \mathbf{b}, \mathbf{d}) \in \mathcal{T}$, so restricting $\mathcal{T}$ to such conditions gives a subspace $\mathcal{L}^{\varphi_R, \varphi_L}$ which is a convex space. □

> __Theorem [cap-tail-extension].__ For any $K \in \mathcal{K}$, the triple $(K, \mathbf{b}_K, \mathbf{d}_K)$ is a member of $\mathcal{L}$. Correspondingly, the map $K \mapsto (K, \mathbf{b}_K, \mathbf{d}_K)$ is a well-defined injection $\mathcal{K} \to \mathcal{L}$. ^thm-cap-tail-extension

_Proof._ As $\mathbf{b}_K \in \mathcal{U}^{\pi + \varphi_R, 3\pi/2}$ and $\mathbf{d}_K \in \mathcal{U}^{\pi, \pi + \varphi_L}$ by Def xx, it suffices to check the conditions of [[c. Optimality of Gerver's Sofa/15. Upper Bound Q/05. Definition of Q#^def-cap-tail-space]].

Width conditions: the set $B_K^0$ is contained in $H_K^b(t)$, so holds.
Equality condition: trickier to show. As $B_K^0 \supseteq B_K \setminus \mathcal{N}_K$ and 

□

> __Definition [upper-bound-q].__ Define the function $\mathcal{Q} : \mathcal{L} \to \mathbb{R}$ as ^def-upper-bound-q
$$
\mathcal{Q}^{\varphi_R, \varphi_L}(K, \mathbf{b}, \mathbf{d}) = |K| - \mathcal{J}(\mathbf{b}) - \mathcal{I}(w_K(\varphi_R), \mathbf{x}_K(\varphi_R)) - \mathcal{I}\left( \mathbf{x}_K|_{[\varphi_R, \varphi_L]} \right) - \mathcal{I}(\mathbf{x}_K(\varphi_L), z_K(\varphi_L)) - \mathcal{J}(\mathbf{d}).
$$

